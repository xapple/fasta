<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.0.0"/>
    <title>fasta.core API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../fasta.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;fasta</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#Dummy">Dummy</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#FASTA">FASTA</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#FASTA.format">format</a>
                        </li>
                        <li>
                                <a class="variable" href="#FASTA.ext">ext</a>
                        </li>
                        <li>
                                <a class="variable" href="#FASTA.buffer_size">buffer_size</a>
                        </li>
                        <li>
                                <a class="variable" href="#FASTA.gzipped">gzipped</a>
                        </li>
                        <li>
                                <a class="variable" href="#FASTA.first">first</a>
                        </li>
                        <li>
                                <a class="variable" href="#FASTA.count">count</a>
                        </li>
                        <li>
                                <a class="variable" href="#FASTA.lengths">lengths</a>
                        </li>
                        <li>
                                <a class="variable" href="#FASTA.lengths_counter">lengths_counter</a>
                        </li>
                        <li>
                                <a class="function" href="#FASTA.open">open</a>
                        </li>
                        <li>
                                <a class="function" href="#FASTA.close">close</a>
                        </li>
                        <li>
                                <a class="function" href="#FASTA.parse">parse</a>
                        </li>
                        <li>
                                <a class="variable" href="#FASTA.progress">progress</a>
                        </li>
                        <li>
                                <a class="function" href="#FASTA.create">create</a>
                        </li>
                        <li>
                                <a class="function" href="#FASTA.add">add</a>
                        </li>
                        <li>
                                <a class="function" href="#FASTA.add_seq">add_seq</a>
                        </li>
                        <li>
                                <a class="function" href="#FASTA.add_str">add_str</a>
                        </li>
                        <li>
                                <a class="function" href="#FASTA.add_fasta">add_fasta</a>
                        </li>
                        <li>
                                <a class="function" href="#FASTA.add_fastas">add_fastas</a>
                        </li>
                        <li>
                                <a class="function" href="#FASTA.flush">flush</a>
                        </li>
                        <li>
                                <a class="function" href="#FASTA.write">write</a>
                        </li>
                        <li>
                                <a class="function" href="#FASTA.compress">compress</a>
                        </li>
                        <li>
                                <a class="function" href="#FASTA.compress_slow">compress_slow</a>
                        </li>
                        <li>
                                <a class="function" href="#FASTA.compress_fast">compress_fast</a>
                        </li>
                        <li>
                                <a class="variable" href="#FASTA.ids">ids</a>
                        </li>
                        <li>
                                <a class="function" href="#FASTA.get_id">get_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#FASTA.sequences">sequences</a>
                        </li>
                        <li>
                                <a class="variable" href="#FASTA.sql">sql</a>
                        </li>
                        <li>
                                <a class="variable" href="#FASTA.length_by_id">length_by_id</a>
                        </li>
                        <li>
                                <a class="function" href="#FASTA.subsample">subsample</a>
                        </li>
                        <li>
                                <a class="function" href="#FASTA.rename_with_num">rename_with_num</a>
                        </li>
                        <li>
                                <a class="function" href="#FASTA.rename_with_prefix">rename_with_prefix</a>
                        </li>
                        <li>
                                <a class="function" href="#FASTA.rename_sequences">rename_sequences</a>
                        </li>
                        <li>
                                <a class="function" href="#FASTA.extract_length">extract_length</a>
                        </li>
                        <li>
                                <a class="function" href="#FASTA.extract_sequences">extract_sequences</a>
                        </li>
                        <li>
                                <a class="function" href="#FASTA.remove_trailing_stars">remove_trailing_stars</a>
                        </li>
                        <li>
                                <a class="function" href="#FASTA.remove_duplicates">remove_duplicates</a>
                        </li>
                        <li>
                                <a class="function" href="#FASTA.convert_U_to_T">convert_U_to_T</a>
                        </li>
                        <li>
                                <a class="function" href="#FASTA.align">align</a>
                        </li>
                        <li>
                                <a class="function" href="#FASTA.template_align">template_align</a>
                        </li>
                        <li>
                                <a class="function" href="#FASTA.index_bowtie">index_bowtie</a>
                        </li>
                        <li>
                                <a class="function" href="#FASTA.index_samtools">index_samtools</a>
                        </li>
                        <li>
                                <a class="variable" href="#FASTA.graphs">graphs</a>
                        </li>
                        <li>
                                <a class="function" href="#FASTA.parse_primers">parse_primers</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../fasta.html">fasta</a><wbr>.core    </h1>

                        <div class="docstring"><p>Written by Lucas Sinclair.
MIT Licensed.
Contact at <a href="www.sinclair.bio">www.sinclair.bio</a></p>
</div>

                        <input id="mod-core-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-core-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="sd">Written by Lucas Sinclair.</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="sd">MIT Licensed.</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="sd">Contact at www.sinclair.bio</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="c1"># Built-in modules #</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">io</span><span class="o">,</span> <span class="nn">gzip</span><span class="o">,</span> <span class="nn">shutil</span><span class="o">,</span> <span class="nn">itertools</span><span class="o">,</span> <span class="nn">platform</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span><span class="p">,</span> <span class="n">OrderedDict</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">from</span> <span class="nn">six</span> <span class="kn">import</span> <span class="n">string_types</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="c1"># Internal modules #</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="kn">from</span> <span class="nn">fasta</span> <span class="kn">import</span> <span class="n">graphs</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="c1"># First party modules #</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="kn">from</span> <span class="nn">plumbing.common</span>     <span class="kn">import</span> <span class="n">isubsample</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="kn">from</span> <span class="nn">plumbing.color</span>      <span class="kn">import</span> <span class="n">Color</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="kn">from</span> <span class="nn">plumbing.cache</span>      <span class="kn">import</span> <span class="n">property_cached</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="kn">from</span> <span class="nn">autopaths.file_path</span> <span class="kn">import</span> <span class="n">FilePath</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="kn">from</span> <span class="nn">autopaths.tmp_path</span>  <span class="kn">import</span> <span class="n">new_temp_path</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="c1"># Third party modules #</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Windows&#39;</span><span class="p">:</span> <span class="kn">import</span> <span class="nn">pbs3</span> <span class="k">as</span> <span class="nn">sh</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="k">else</span><span class="p">:</span> <span class="kn">import</span> <span class="nn">sh</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="c1"># Constants #</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="k">class</span> <span class="nc">Dummy</span><span class="p">:</span> <span class="k">pass</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="c1">###############################################################################</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="k">class</span> <span class="nc">FASTA</span><span class="p">(</span><span class="n">FilePath</span><span class="p">):</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">    A single FASTA file somewhere in the filesystem. You can read from it in</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">    several convenient ways. You can write to it in a automatically buffered</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">    way. There are several other things you can do with a FASTA file.</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>    <span class="nb">format</span>      <span class="o">=</span> <span class="s1">&#39;fasta&#39;</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>    <span class="n">ext</span>         <span class="o">=</span> <span class="s1">&#39;fasta&#39;</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>    <span class="n">buffer_size</span> <span class="o">=</span> <span class="mi">1000</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1"> object on &quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="n">other</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">():</span> <span class="k">yield</span> <span class="n">seq</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>        <span class="k">if</span>   <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>          <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">items</span><span class="p">()[</span><span class="n">key</span><span class="p">]</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>            <span class="k">return</span> <span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>    <span class="c1">#----------------------------- Properties --------------------------------#</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>    <span class="nd">@property</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>    <span class="k">def</span> <span class="nf">gzipped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="kc">True</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;gz&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>    <span class="nd">@property</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>    <span class="k">def</span> <span class="nf">first</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Just the first sequence.&quot;&quot;&quot;</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>        <span class="kn">from</span> <span class="nn">Bio</span> <span class="kn">import</span> <span class="n">SeqIO</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>        <span class="n">seq</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">SeqIO</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">))</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>        <span class="k">return</span> <span class="n">seq</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>    <span class="nd">@property_cached</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">        Should probably check for file size changes instead of just</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">        caching once TODO.</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>        <span class="c1"># For debugging purposes #</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>        <span class="k">if</span> <span class="kc">False</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&gt; counting reads in `</span><span class="si">%s</span><span class="s2">`&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>        <span class="c1"># If we are gzipped we can just use zgrep #</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gzipped</span><span class="p">:</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">sh</span><span class="o">.</span><span class="n">zgrep</span><span class="p">(</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s2">&quot;^&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">_ok_code</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">sh</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s2">&quot;^&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">_ok_code</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>    <span class="nd">@property</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>    <span class="k">def</span> <span class="nf">lengths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;All the lengths, one by one, in a list.&quot;&quot;&quot;</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>        <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>    <span class="nd">@property_cached</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>    <span class="k">def</span> <span class="nf">lengths_counter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A Counter() object with all the lengths inside.&quot;&quot;&quot;</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>        <span class="k">return</span> <span class="n">Counter</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">()))</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>    <span class="c1">#-------------------------- Basic IO methods -----------------------------#</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">):</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>        <span class="c1"># Two cases #</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gzipped</span><span class="p">:</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>        <span class="c1"># For convenience #</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>        <span class="c1"># Case we were writing to the file #</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;buffer&#39;</span><span class="p">):</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>        <span class="c1"># Standard case #</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>        <span class="c1"># For pickling purposes (can&#39;t use dill on gzip handles) #</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>        <span class="kn">from</span> <span class="nn">Bio</span> <span class="kn">import</span> <span class="n">SeqIO</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>        <span class="k">return</span> <span class="n">SeqIO</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>    <span class="nd">@property</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>    <span class="k">def</span> <span class="nf">progress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Just like self.parse() but will display a progress bar.&quot;&quot;&quot;</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>        <span class="k">return</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the file on the file system.&quot;&quot;&quot;</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">buf_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seqs</span><span class="p">):</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Use this method to add a bunch of SeqRecords at once.&quot;&quot;&quot;</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="n">seqs</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_seq</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>    <span class="k">def</span> <span class="nf">add_seq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span><span class="p">):</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Use this method to add a SeqRecord object to this fasta.&quot;&quot;&quot;</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">buf_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">buf_count</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>    <span class="k">def</span> <span class="nf">add_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Use this method to add a sequence as a string to this fasta.&quot;&quot;&quot;</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>        <span class="kn">from</span> <span class="nn">Bio.SeqRecord</span> <span class="kn">import</span> <span class="n">SeqRecord</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>        <span class="kn">from</span> <span class="nn">Bio.Seq</span> <span class="kn">import</span> <span class="n">Seq</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_seq</span><span class="p">(</span><span class="n">SeqRecord</span><span class="p">(</span><span class="n">Seq</span><span class="p">(</span><span class="n">seq</span><span class="p">),</span> <span class="nb">id</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">))</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>    <span class="k">def</span> <span class="nf">add_fasta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Use this method to add an other fasta to this fasta.&quot;&quot;&quot;</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">FASTA</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>    <span class="k">def</span> <span class="nf">add_fastas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paths</span><span class="p">):</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Use this method to add a bunch of fastas to this fasta.&quot;&quot;&quot;</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_fasta</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>    <span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Empty the buffer.&quot;&quot;&quot;</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>        <span class="kn">from</span> <span class="nn">Bio</span> <span class="kn">import</span> <span class="n">SeqIO</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">:</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>            <span class="n">SeqIO</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reads</span><span class="p">):</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>        <span class="kn">from</span> <span class="nn">Bio</span> <span class="kn">import</span> <span class="n">SeqIO</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        <span class="n">SeqIO</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">reads</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>    <span class="c1">#-------------------------- Compressing the data -------------------------#</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>    <span class="k">def</span> <span class="nf">compress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remove_orig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;slow&#39;</span><span class="p">):</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Turn this FASTA file into a gzipped FASTA file.&quot;&quot;&quot;</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>        <span class="c1"># Check we are not compressed already #</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gzipped</span><span class="p">:</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;The fasta file &#39;</span><span class="si">%s</span><span class="s2">&#39; is already compressed.&quot;</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>        <span class="c1"># Pick the new path #</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>        <span class="k">if</span> <span class="n">new_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">new_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;.gz&#39;</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>        <span class="c1"># Do it the fast way or the slow way #</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;fast&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">compress_fast</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>        <span class="k">else</span><span class="p">:</span>                <span class="bp">self</span><span class="o">.</span><span class="n">compress_slow</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>        <span class="c1"># Optionally remove the original uncompressed file #</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>        <span class="k">if</span> <span class="n">remove_orig</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>        <span class="c1"># Update the internal path #</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">new_path</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>        <span class="c1"># Return #</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>    <span class="k">def</span> <span class="nf">compress_slow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_path</span><span class="p">):</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Do the compression internally via python.&quot;&quot;&quot;</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>        <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;rb&#39;</span><span class="p">),</span> <span class="n">handle</span><span class="p">)</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>    <span class="k">def</span> <span class="nf">compress_fast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_path</span><span class="p">):</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Do the compression with an external shell command call.&quot;&quot;&quot;</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>        <span class="c1"># We don&#39;t want python to be buffering the text for speed #</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>        <span class="kn">from</span> <span class="nn">shell_command</span> <span class="kn">import</span> <span class="n">shell_output</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>        <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;gzip --stdout </span><span class="si">%s</span><span class="s1"> &gt; </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>        <span class="k">return</span> <span class="n">shell_output</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>    <span class="c1">#------------------------- When IDs are important ------------------------#</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>    <span class="nd">@property_cached</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>    <span class="k">def</span> <span class="nf">ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A frozen set of all unique IDs in the file.&quot;&quot;&quot;</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>        <span class="n">as_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">seq</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>        <span class="n">as_set</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">as_list</span><span class="p">)</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">as_set</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">as_list</span><span class="p">)</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>        <span class="k">return</span> <span class="n">as_set</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>    <span class="k">def</span> <span class="nf">get_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">id_num</span><span class="p">):</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a><span class="sd">        Extract one sequence from the file based on its ID.</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a><span class="sd">        This is highly ineffective.</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a><span class="sd">        Consider using the SQLite API instead or memory map the file.</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>            <span class="k">if</span> <span class="n">seq</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">id_num</span><span class="p">:</span> <span class="k">return</span> <span class="n">seq</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>    <span class="nd">@property_cached</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>    <span class="k">def</span> <span class="nf">sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="sd">        Another way of easily retrieving sequences. Also highly ineffective.</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="sd">        Consider using the SQLite API instead.</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>        <span class="k">return</span> <span class="n">OrderedDict</span><span class="p">(((</span><span class="n">seq</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">seq</span><span class="p">)</span> <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">))</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>    <span class="nd">@property_cached</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>    <span class="k">def</span> <span class="nf">sql</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="sd">        If you access this attribute, we will build an SQLite database</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="sd">        out of the FASTA file and you will be able access everything in an</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a><span class="sd">        indexed fashion, and use the blaze library via sql.frame</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>        <span class="kn">from</span> <span class="nn">fasta.indexed</span> <span class="kn">import</span> <span class="n">DatabaseFASTA</span><span class="p">,</span> <span class="n">fasta_to_sql</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>        <span class="n">db</span> <span class="o">=</span> <span class="n">DatabaseFASTA</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix_path</span> <span class="o">+</span> <span class="s2">&quot;.db&quot;</span><span class="p">)</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">db</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span> <span class="n">fasta_to_sql</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>        <span class="k">return</span> <span class="n">db</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>    <span class="nd">@property_cached</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>    <span class="k">def</span> <span class="nf">length_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a><span class="sd">        In some use cases you just need the sequence lengths in an indexed</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a><span class="sd">        fashion. If you access this attribute, we will make a hash map in</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a><span class="sd">        memory.</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>        <span class="n">hash_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">seq</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">))</span> <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>        <span class="n">tmp</span> <span class="o">=</span> <span class="n">hash_map</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>        <span class="n">hash_map</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>        <span class="k">return</span> <span class="n">hash_map</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>    <span class="c1">#----------------- Ways of interacting with the data --------------------#</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>    <span class="k">def</span> <span class="nf">subsample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">down_to</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pick a given number of sequences from the file pseudo-randomly.&quot;&quot;&quot;</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>        <span class="c1"># Pick the destination path #</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>        <span class="k">if</span> <span class="n">new_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>            <span class="n">subsampled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_temp_path</span><span class="p">())</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">FASTA</span><span class="p">):</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>            <span class="n">subsampled</span> <span class="o">=</span> <span class="n">new_path</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>            <span class="n">subsampled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>        <span class="c1"># Check size #</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>        <span class="k">if</span> <span class="n">down_to</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Can&#39;t subsample </span><span class="si">%s</span><span class="s2"> down to </span><span class="si">%i</span><span class="s2">. Only down to </span><span class="si">%i</span><span class="s2">.&quot;</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">Color</span><span class="o">.</span><span class="n">ylw</span> <span class="o">+</span> <span class="n">message</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">down_to</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">+</span> <span class="n">Color</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>            <span class="k">return</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>        <span class="c1"># Select verbosity #</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>        <span class="kn">import</span> <span class="nn">tqdm</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="n">wrapper</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>        <span class="k">else</span><span class="p">:</span> <span class="n">wrapper</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>        <span class="c1"># Generator #</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>        <span class="k">def</span> <span class="nf">iterator</span><span class="p">():</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>            <span class="k">for</span> <span class="n">read</span> <span class="ow">in</span> <span class="n">wrapper</span><span class="p">(</span><span class="n">isubsample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">down_to</span><span class="p">)):</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>                <span class="k">yield</span> <span class="n">read</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>        <span class="c1"># Do it #</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>        <span class="n">subsampled</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">iterator</span><span class="p">())</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>        <span class="c1"># Did it work #</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">subsampled</span><span class="p">)</span> <span class="o">==</span> <span class="n">down_to</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>        <span class="c1"># Return #</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>        <span class="k">return</span> <span class="n">subsampled</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>    <span class="k">def</span> <span class="nf">rename_with_num</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remove_desc</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Rename every sequence based on a prefix and a number.&quot;&quot;&quot;</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>        <span class="c1"># Temporary path #</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>        <span class="k">if</span> <span class="n">new_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">numbered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_temp_path</span><span class="p">())</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>        <span class="k">else</span><span class="p">:</span>                <span class="n">numbered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>        <span class="c1"># Generator #</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>        <span class="k">def</span> <span class="nf">numbered_iterator</span><span class="p">():</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">read</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>                <span class="n">read</span><span class="o">.</span><span class="n">id</span>  <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>                <span class="n">read</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>                <span class="k">if</span> <span class="n">remove_desc</span><span class="p">:</span> <span class="n">read</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>                <span class="k">yield</span> <span class="n">read</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>        <span class="c1"># Do it #</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>        <span class="n">numbered</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">numbered_iterator</span><span class="p">())</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>        <span class="c1"># Replace it #</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>        <span class="k">if</span> <span class="n">new_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">numbered</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>        <span class="c1"># Return #</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>        <span class="k">return</span> <span class="n">numbered</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>    <span class="k">def</span> <span class="nf">rename_with_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>                           <span class="n">remove_desc</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Rename every sequence based on a prefix.&quot;&quot;&quot;</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>        <span class="c1"># Temporary path #</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>        <span class="k">if</span> <span class="n">new_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">prefixed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_temp_path</span><span class="p">())</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>        <span class="k">else</span><span class="p">:</span>                <span class="n">prefixed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>        <span class="c1"># Generator #</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>        <span class="k">def</span> <span class="nf">prefixed_iterator</span><span class="p">():</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">read</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>                <span class="n">read</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">read</span><span class="o">.</span><span class="n">id</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>                <span class="k">if</span> <span class="n">remove_desc</span><span class="p">:</span> <span class="n">read</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>                <span class="k">yield</span> <span class="n">read</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>        <span class="c1"># Do it #</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>        <span class="n">prefixed</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">prefixed_iterator</span><span class="p">())</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>        <span class="c1"># Replace it #</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>        <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">prefixed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>        <span class="c1"># Return #</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>        <span class="k">return</span> <span class="n">prefixed</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>    <span class="k">def</span> <span class="nf">rename_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapping</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a><span class="sd">        Will rename all sequences in the current fasta file using</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a><span class="sd">        the mapping dictionary also provided. In place or at a new path.</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>        <span class="c1"># Where is the new file #</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>        <span class="k">if</span> <span class="n">new_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">new_fasta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_temp_path</span><span class="p">())</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>        <span class="k">else</span><span class="p">:</span>                <span class="n">new_fasta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>        <span class="c1"># Do it #</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>        <span class="n">new_fasta</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>            <span class="n">new_name</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="n">seq</span><span class="o">.</span><span class="n">description</span><span class="p">]</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>            <span class="n">nucleotides</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">seq</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>            <span class="n">new_fasta</span><span class="o">.</span><span class="n">add_str</span><span class="p">(</span><span class="n">nucleotides</span><span class="p">,</span> <span class="n">new_name</span><span class="p">)</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>        <span class="n">new_fasta</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>        <span class="c1"># Return #</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>        <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">new_fasta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">new_fasta</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>    <span class="k">def</span> <span class="nf">extract_length</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lower_bound</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>                             <span class="n">upper_bound</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>                             <span class="n">new_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract a certain length fraction and place them in a new file.&quot;&quot;&quot;</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>        <span class="c1"># Temporary path #</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>        <span class="k">if</span> <span class="n">new_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">fraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_temp_path</span><span class="p">())</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">FASTA</span><span class="p">):</span> <span class="n">fraction</span> <span class="o">=</span> <span class="n">new_path</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>        <span class="k">else</span><span class="p">:</span>                <span class="n">fraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>        <span class="c1"># Generator #</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>        <span class="k">if</span> <span class="n">lower_bound</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">lower_bound</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>        <span class="k">if</span> <span class="n">upper_bound</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>        <span class="k">def</span> <span class="nf">fraction_iterator</span><span class="p">():</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>            <span class="k">for</span> <span class="n">read</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>                <span class="k">if</span> <span class="n">lower_bound</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">read</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">upper_bound</span><span class="p">:</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>                    <span class="k">yield</span> <span class="n">read</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>        <span class="c1"># Do it #</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>        <span class="n">fraction</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fraction_iterator</span><span class="p">())</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>        <span class="c1"># Return #</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>        <span class="k">return</span> <span class="n">fraction</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>    <span class="k">def</span> <span class="nf">extract_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>                          <span class="n">new_path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>                          <span class="n">in_place</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>                          <span class="n">verbose</span>  <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a><span class="sd">        Will take all the sequences from the current file who&#39;s id appears in</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a><span class="sd">        the ids given and place them in a new file.</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a><span class="sd">        If no path is given, a new temporary path is created and returned.</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a><span class="sd">        If `in_place` is set to True, the original file is removed and replaced</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a><span class="sd">        with the result of the extraction.</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a><span class="sd">        Optionally, the argument `ids` can be a function which has to take</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a><span class="sd">        one string as only input and return True for keeping the sequence and</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a><span class="sd">        False for discarding the sequence.</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>        <span class="c1"># Temporary path #</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>        <span class="k">if</span> <span class="n">new_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">new_fasta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_temp_path</span><span class="p">())</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">FASTA</span><span class="p">):</span> <span class="n">new_fasta</span> <span class="o">=</span> <span class="n">new_path</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>        <span class="k">else</span><span class="p">:</span>                <span class="n">new_fasta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>        <span class="c1"># Select verbosity #</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>        <span class="kn">import</span> <span class="nn">tqdm</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>        <span class="n">wrapper</span> <span class="o">=</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span> <span class="k">if</span> <span class="n">verbose</span> <span class="k">else</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>        <span class="c1"># Simple generator #</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>        <span class="k">def</span> <span class="nf">simple_match</span><span class="p">(</span><span class="n">reads</span><span class="p">):</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">wrapper</span><span class="p">(</span><span class="n">reads</span><span class="p">):</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>                <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span> <span class="k">yield</span> <span class="n">r</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>        <span class="c1"># Generator with function #</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>        <span class="k">def</span> <span class="nf">function_match</span><span class="p">(</span><span class="n">reads</span><span class="p">):</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">wrapper</span><span class="p">(</span><span class="n">reads</span><span class="p">):</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>                <span class="k">if</span> <span class="n">ids</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">id</span><span class="p">):</span> <span class="k">yield</span> <span class="n">r</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>        <span class="c1"># Do it #</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">ids</span><span class="p">):</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>            <span class="n">new_fasta</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">function_match</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>            <span class="n">new_fasta</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">simple_match</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>        <span class="c1"># Return #</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>        <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">new_fasta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">new_fasta</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>    <span class="k">def</span> <span class="nf">remove_trailing_stars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a><span class="sd">        Remove the bad character that can be inserted by some programs at the</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a><span class="sd">        end of sequences.</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>        <span class="c1"># Optional check #</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>        <span class="k">if</span> <span class="n">check</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">sh</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">*&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">_ok_code</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>        <span class="c1"># Faster with bash utilities #</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>        <span class="k">if</span> <span class="n">in_place</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>            <span class="n">sh</span><span class="o">.</span><span class="n">sed</span><span class="p">(</span><span class="s1">&#39;-i&#39;</span><span class="p">,</span> <span class="s1">&#39;s/</span><span class="se">\\</span><span class="s1">*$//g&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>        <span class="c1"># Standard way #</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>        <span class="k">if</span> <span class="n">new_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">new_fasta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_temp_path</span><span class="p">())</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>        <span class="k">else</span><span class="p">:</span>                <span class="n">new_fasta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>        <span class="n">new_fasta</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span> <span class="n">new_fasta</span><span class="o">.</span><span class="n">add_str</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">seq</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">),</span> <span class="n">seq</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>        <span class="n">new_fasta</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>        <span class="c1"># Return #</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>        <span class="k">return</span> <span class="n">new_fasta</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>    <span class="k">def</span> <span class="nf">_generator_mod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a><span class="sd">        Generic way of modifying the current fasta either in place or</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a><span class="sd">        with a new destination pass.</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a><span class="sd">        Simply, pass a generator function that will yield the new sequences</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a><span class="sd">        given the current ones.</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>        <span class="c1"># Temporary path #</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>        <span class="k">if</span> <span class="n">new_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">new_fasta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_temp_path</span><span class="p">())</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">FASTA</span><span class="p">):</span> <span class="n">new_fasta</span> <span class="o">=</span> <span class="n">new_path</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>        <span class="k">else</span><span class="p">:</span> <span class="n">new_fasta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>        <span class="c1"># Do it #</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>        <span class="n">new_fasta</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">generator</span><span class="p">())</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>        <span class="c1"># Return #</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>        <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">new_fasta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">new_fasta</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>    <span class="k">def</span> <span class="nf">remove_duplicates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a><span class="sd">        If several entries have the same ID in the FASTA file, keep only the</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a><span class="sd">        first appearance and remove all the others.</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>        <span class="c1"># Generator #</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>        <span class="k">def</span> <span class="nf">unique_entries</span><span class="p">():</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>            <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">read</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>                <span class="k">if</span> <span class="n">read</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span> <span class="k">continue</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>                    <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">read</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>                    <span class="k">yield</span> <span class="n">read</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>        <span class="c1"># Return #</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generator_mod</span><span class="p">(</span><span class="n">unique_entries</span><span class="p">,</span> <span class="n">new_path</span><span class="p">,</span> <span class="n">in_place</span><span class="p">)</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>    <span class="k">def</span> <span class="nf">convert_U_to_T</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>        <span class="c1"># Generator #</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>        <span class="k">def</span> <span class="nf">all_U_to_T</span><span class="p">():</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">read</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>                <span class="n">read</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">back_transcribe</span><span class="p">()</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>                <span class="k">yield</span> <span class="n">read</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>        <span class="c1"># Return #</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generator_mod</span><span class="p">(</span><span class="n">all_U_to_T</span><span class="p">,</span> <span class="n">new_path</span><span class="p">,</span> <span class="n">in_place</span><span class="p">)</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>    <span class="c1">#---------------------------- Third party programs -----------------------#</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>    <span class="k">def</span> <span class="nf">align</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;We align the sequences in the fasta file with muscle.&quot;&quot;&quot;</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>        <span class="k">if</span> <span class="n">out_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">out_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix_path</span> <span class="o">+</span> <span class="s1">&#39;.aln&#39;</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>        <span class="n">sh</span><span class="o">.</span><span class="n">muscle38</span><span class="p">(</span><span class="s2">&quot;-in&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;-out&quot;</span><span class="p">,</span> <span class="n">out_path</span><span class="p">)</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>        <span class="kn">from</span> <span class="nn">fasta.aligned</span> <span class="kn">import</span> <span class="n">AlignedFASTA</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>        <span class="k">return</span> <span class="n">AlignedFASTA</span><span class="p">(</span><span class="n">out_path</span><span class="p">)</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>    <span class="k">def</span> <span class="nf">template_align</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_path</span><span class="p">):</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a><span class="sd">        We align the sequences in the fasta file with mothur and a template.</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>        <span class="c1"># Run it #</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;#align.seqs(candidate=</span><span class="si">%s</span><span class="s2">, template=</span><span class="si">%s</span><span class="s2">, search=blast,&quot;</span> \
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>              <span class="s2">&quot;flip=false, processors=8);&quot;</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>        <span class="n">sh</span><span class="o">.</span><span class="n">mothur</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">ref_path</span><span class="p">))</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>        <span class="c1"># Move things #</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.align&#39;</span><span class="p">,</span>        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">aligned</span><span class="p">)</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.align.report&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">report</span><span class="p">)</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.flip.accnos&#39;</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">accnos</span><span class="p">)</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>        <span class="c1"># Clean up #</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;formatdb.log&#39;</span><span class="p">):</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;formatdb.log&#39;</span><span class="p">)</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;error.log&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="s1">&#39;error.log&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;error.log&#39;</span><span class="p">)</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">sh</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;mothur.*.logfile&#39;</span><span class="p">):</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>        <span class="c1"># Return #</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">aligned</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>    <span class="k">def</span> <span class="nf">index_bowtie</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an index on the fasta file compatible with bowtie2.&quot;&quot;&quot;</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>        <span class="c1"># It returns exit code 1 if the fasta is empty #</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>        <span class="k">assert</span> <span class="bp">self</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>        <span class="c1"># Call the bowtie executable #</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>        <span class="n">sh</span><span class="o">.</span><span class="n">bowtie2_build</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>        <span class="k">return</span> <span class="n">FilePath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;.1.bt2&#39;</span><span class="p">)</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>    <span class="k">def</span> <span class="nf">index_samtools</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an index on the fasta file compatible with samtools.&quot;&quot;&quot;</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>        <span class="n">sh</span><span class="o">.</span><span class="n">samtools</span><span class="p">(</span><span class="s1">&#39;faidx&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>        <span class="k">return</span> <span class="n">FilePath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;.fai&#39;</span><span class="p">)</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>    <span class="c1">#--------------------------------- Graphs --------------------------------#</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>    <span class="nd">@property_cached</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>    <span class="k">def</span> <span class="nf">graphs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a><span class="sd">        Sorry for the black magic. The result is an object whose attributes</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a><span class="sd">        are all the graphs found in `./graphs.py` initialized with this</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a><span class="sd">        instance as only argument.</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>        <span class="c1"># Make a dummy object #</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">Dummy</span><span class="p">()</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>        <span class="c1"># Loop over graphs #</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>        <span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="n">graphs</span><span class="o">.</span><span class="n">__all__</span><span class="p">:</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>            <span class="bp">cls</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">graphs</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">short_name</span><span class="p">,</span> <span class="bp">cls</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>        <span class="c1"># Return #</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>    <span class="c1">#-------------------------------- Primers -------------------------------#</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>    <span class="k">def</span> <span class="nf">parse_primers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">primers</span><span class="p">,</span> <span class="n">mismatches</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a><span class="sd">        Takes care of identifying primers inside every sequence.</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a><span class="sd">        Instead of yielding Seq objects now we yield ReadWithPrimers objects.</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a><span class="sd">        These have extra properties that show the start and end positions</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a><span class="sd">        of all primers found.</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>        <span class="c1"># Default is zero #</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>        <span class="k">if</span> <span class="n">mismatches</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">mismatches</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>        <span class="c1"># Get the search expressions with mismatches #</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>        <span class="kn">from</span> <span class="nn">fasta.primers</span> <span class="kn">import</span> <span class="n">PrimersRegexes</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>        <span class="n">regexes</span> <span class="o">=</span> <span class="n">PrimersRegexes</span><span class="p">(</span><span class="n">primers</span><span class="p">,</span> <span class="n">mismatches</span><span class="p">)</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>        <span class="c1"># Generate a new special object for every read #</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>        <span class="kn">from</span> <span class="nn">fasta.primers</span> <span class="kn">import</span> <span class="n">ReadWithPrimers</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>        <span class="n">read_with_primer</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">read</span><span class="p">:</span> <span class="n">ReadWithPrimers</span><span class="p">(</span><span class="n">read</span><span class="p">,</span> <span class="n">regexes</span><span class="p">)</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>        <span class="n">generator</span> <span class="o">=</span> <span class="p">(</span><span class="n">read_with_primer</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">())</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>        <span class="c1"># Add the length to the generator #</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>        <span class="kn">from</span> <span class="nn">plumbing.common</span> <span class="kn">import</span> <span class="n">GenWithLength</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>        <span class="n">generator</span> <span class="o">=</span> <span class="n">GenWithLength</span><span class="p">(</span><span class="n">generator</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>        <span class="c1"># Return #</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>        <span class="k">return</span> <span class="n">generator</span>
</span></pre></div>


            </section>
                <section id="Dummy">
                            <input id="Dummy-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Dummy</span>:

                <label class="view-source-button" for="Dummy-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Dummy"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Dummy-32"><a href="#Dummy-32"><span class="linenos">32</span></a><span class="k">class</span> <span class="nc">Dummy</span><span class="p">:</span> <span class="k">pass</span>
</span></pre></div>


    

                </section>
                <section id="FASTA">
                            <input id="FASTA-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">FASTA</span><wbr>(<span class="base">autopaths.file_path.FilePath</span>):

                <label class="view-source-button" for="FASTA-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA-35"><a href="#FASTA-35"><span class="linenos"> 35</span></a><span class="k">class</span> <span class="nc">FASTA</span><span class="p">(</span><span class="n">FilePath</span><span class="p">):</span>
</span><span id="FASTA-36"><a href="#FASTA-36"><span class="linenos"> 36</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FASTA-37"><a href="#FASTA-37"><span class="linenos"> 37</span></a><span class="sd">    A single FASTA file somewhere in the filesystem. You can read from it in</span>
</span><span id="FASTA-38"><a href="#FASTA-38"><span class="linenos"> 38</span></a><span class="sd">    several convenient ways. You can write to it in a automatically buffered</span>
</span><span id="FASTA-39"><a href="#FASTA-39"><span class="linenos"> 39</span></a><span class="sd">    way. There are several other things you can do with a FASTA file.</span>
</span><span id="FASTA-40"><a href="#FASTA-40"><span class="linenos"> 40</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="FASTA-41"><a href="#FASTA-41"><span class="linenos"> 41</span></a>
</span><span id="FASTA-42"><a href="#FASTA-42"><span class="linenos"> 42</span></a>    <span class="nb">format</span>      <span class="o">=</span> <span class="s1">&#39;fasta&#39;</span>
</span><span id="FASTA-43"><a href="#FASTA-43"><span class="linenos"> 43</span></a>    <span class="n">ext</span>         <span class="o">=</span> <span class="s1">&#39;fasta&#39;</span>
</span><span id="FASTA-44"><a href="#FASTA-44"><span class="linenos"> 44</span></a>    <span class="n">buffer_size</span> <span class="o">=</span> <span class="mi">1000</span>
</span><span id="FASTA-45"><a href="#FASTA-45"><span class="linenos"> 45</span></a>
</span><span id="FASTA-46"><a href="#FASTA-46"><span class="linenos"> 46</span></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span>
</span><span id="FASTA-47"><a href="#FASTA-47"><span class="linenos"> 47</span></a>
</span><span id="FASTA-48"><a href="#FASTA-48"><span class="linenos"> 48</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA-49"><a href="#FASTA-49"><span class="linenos"> 49</span></a>        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1"> object on &quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA-50"><a href="#FASTA-50"><span class="linenos"> 50</span></a>
</span><span id="FASTA-51"><a href="#FASTA-51"><span class="linenos"> 51</span></a>    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="n">other</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span>
</span><span id="FASTA-52"><a href="#FASTA-52"><span class="linenos"> 52</span></a>
</span><span id="FASTA-53"><a href="#FASTA-53"><span class="linenos"> 53</span></a>    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
</span><span id="FASTA-54"><a href="#FASTA-54"><span class="linenos"> 54</span></a>
</span><span id="FASTA-55"><a href="#FASTA-55"><span class="linenos"> 55</span></a>    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="FASTA-56"><a href="#FASTA-56"><span class="linenos"> 56</span></a>
</span><span id="FASTA-57"><a href="#FASTA-57"><span class="linenos"> 57</span></a>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA-58"><a href="#FASTA-58"><span class="linenos"> 58</span></a>        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">():</span> <span class="k">yield</span> <span class="n">seq</span>
</span><span id="FASTA-59"><a href="#FASTA-59"><span class="linenos"> 59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="FASTA-60"><a href="#FASTA-60"><span class="linenos"> 60</span></a>
</span><span id="FASTA-61"><a href="#FASTA-61"><span class="linenos"> 61</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span><span id="FASTA-62"><a href="#FASTA-62"><span class="linenos"> 62</span></a>        <span class="k">if</span>   <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="FASTA-63"><a href="#FASTA-63"><span class="linenos"> 63</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>          <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">items</span><span class="p">()[</span><span class="n">key</span><span class="p">]</span>
</span><span id="FASTA-64"><a href="#FASTA-64"><span class="linenos"> 64</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
</span><span id="FASTA-65"><a href="#FASTA-65"><span class="linenos"> 65</span></a>            <span class="k">return</span> <span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
</span><span id="FASTA-66"><a href="#FASTA-66"><span class="linenos"> 66</span></a>
</span><span id="FASTA-67"><a href="#FASTA-67"><span class="linenos"> 67</span></a>    <span class="c1">#----------------------------- Properties --------------------------------#</span>
</span><span id="FASTA-68"><a href="#FASTA-68"><span class="linenos"> 68</span></a>    <span class="nd">@property</span>
</span><span id="FASTA-69"><a href="#FASTA-69"><span class="linenos"> 69</span></a>    <span class="k">def</span> <span class="nf">gzipped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="kc">True</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;gz&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>
</span><span id="FASTA-70"><a href="#FASTA-70"><span class="linenos"> 70</span></a>
</span><span id="FASTA-71"><a href="#FASTA-71"><span class="linenos"> 71</span></a>    <span class="nd">@property</span>
</span><span id="FASTA-72"><a href="#FASTA-72"><span class="linenos"> 72</span></a>    <span class="k">def</span> <span class="nf">first</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA-73"><a href="#FASTA-73"><span class="linenos"> 73</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Just the first sequence.&quot;&quot;&quot;</span>
</span><span id="FASTA-74"><a href="#FASTA-74"><span class="linenos"> 74</span></a>        <span class="kn">from</span> <span class="nn">Bio</span> <span class="kn">import</span> <span class="n">SeqIO</span>
</span><span id="FASTA-75"><a href="#FASTA-75"><span class="linenos"> 75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
</span><span id="FASTA-76"><a href="#FASTA-76"><span class="linenos"> 76</span></a>        <span class="n">seq</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">SeqIO</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">))</span>
</span><span id="FASTA-77"><a href="#FASTA-77"><span class="linenos"> 77</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="FASTA-78"><a href="#FASTA-78"><span class="linenos"> 78</span></a>        <span class="k">return</span> <span class="n">seq</span>
</span><span id="FASTA-79"><a href="#FASTA-79"><span class="linenos"> 79</span></a>
</span><span id="FASTA-80"><a href="#FASTA-80"><span class="linenos"> 80</span></a>    <span class="nd">@property_cached</span>
</span><span id="FASTA-81"><a href="#FASTA-81"><span class="linenos"> 81</span></a>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA-82"><a href="#FASTA-82"><span class="linenos"> 82</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FASTA-83"><a href="#FASTA-83"><span class="linenos"> 83</span></a><span class="sd">        Should probably check for file size changes instead of just</span>
</span><span id="FASTA-84"><a href="#FASTA-84"><span class="linenos"> 84</span></a><span class="sd">        caching once TODO.</span>
</span><span id="FASTA-85"><a href="#FASTA-85"><span class="linenos"> 85</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FASTA-86"><a href="#FASTA-86"><span class="linenos"> 86</span></a>        <span class="c1"># For debugging purposes #</span>
</span><span id="FASTA-87"><a href="#FASTA-87"><span class="linenos"> 87</span></a>        <span class="k">if</span> <span class="kc">False</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&gt; counting reads in `</span><span class="si">%s</span><span class="s2">`&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA-88"><a href="#FASTA-88"><span class="linenos"> 88</span></a>        <span class="c1"># If we are gzipped we can just use zgrep #</span>
</span><span id="FASTA-89"><a href="#FASTA-89"><span class="linenos"> 89</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gzipped</span><span class="p">:</span>
</span><span id="FASTA-90"><a href="#FASTA-90"><span class="linenos"> 90</span></a>            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">sh</span><span class="o">.</span><span class="n">zgrep</span><span class="p">(</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s2">&quot;^&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">_ok_code</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="FASTA-91"><a href="#FASTA-91"><span class="linenos"> 91</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FASTA-92"><a href="#FASTA-92"><span class="linenos"> 92</span></a>            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">sh</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s2">&quot;^&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">_ok_code</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="FASTA-93"><a href="#FASTA-93"><span class="linenos"> 93</span></a>
</span><span id="FASTA-94"><a href="#FASTA-94"><span class="linenos"> 94</span></a>    <span class="nd">@property</span>
</span><span id="FASTA-95"><a href="#FASTA-95"><span class="linenos"> 95</span></a>    <span class="k">def</span> <span class="nf">lengths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA-96"><a href="#FASTA-96"><span class="linenos"> 96</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;All the lengths, one by one, in a list.&quot;&quot;&quot;</span>
</span><span id="FASTA-97"><a href="#FASTA-97"><span class="linenos"> 97</span></a>        <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="FASTA-98"><a href="#FASTA-98"><span class="linenos"> 98</span></a>
</span><span id="FASTA-99"><a href="#FASTA-99"><span class="linenos"> 99</span></a>    <span class="nd">@property_cached</span>
</span><span id="FASTA-100"><a href="#FASTA-100"><span class="linenos">100</span></a>    <span class="k">def</span> <span class="nf">lengths_counter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA-101"><a href="#FASTA-101"><span class="linenos">101</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A Counter() object with all the lengths inside.&quot;&quot;&quot;</span>
</span><span id="FASTA-102"><a href="#FASTA-102"><span class="linenos">102</span></a>        <span class="k">return</span> <span class="n">Counter</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">()))</span>
</span><span id="FASTA-103"><a href="#FASTA-103"><span class="linenos">103</span></a>
</span><span id="FASTA-104"><a href="#FASTA-104"><span class="linenos">104</span></a>    <span class="c1">#-------------------------- Basic IO methods -----------------------------#</span>
</span><span id="FASTA-105"><a href="#FASTA-105"><span class="linenos">105</span></a>    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">):</span>
</span><span id="FASTA-106"><a href="#FASTA-106"><span class="linenos">106</span></a>        <span class="c1"># Two cases #</span>
</span><span id="FASTA-107"><a href="#FASTA-107"><span class="linenos">107</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gzipped</span><span class="p">:</span>
</span><span id="FASTA-108"><a href="#FASTA-108"><span class="linenos">108</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
</span><span id="FASTA-109"><a href="#FASTA-109"><span class="linenos">109</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
</span><span id="FASTA-110"><a href="#FASTA-110"><span class="linenos">110</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FASTA-111"><a href="#FASTA-111"><span class="linenos">111</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
</span><span id="FASTA-112"><a href="#FASTA-112"><span class="linenos">112</span></a>        <span class="c1"># For convenience #</span>
</span><span id="FASTA-113"><a href="#FASTA-113"><span class="linenos">113</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle</span>
</span><span id="FASTA-114"><a href="#FASTA-114"><span class="linenos">114</span></a>
</span><span id="FASTA-115"><a href="#FASTA-115"><span class="linenos">115</span></a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA-116"><a href="#FASTA-116"><span class="linenos">116</span></a>        <span class="c1"># Case we were writing to the file #</span>
</span><span id="FASTA-117"><a href="#FASTA-117"><span class="linenos">117</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;buffer&#39;</span><span class="p">):</span>
</span><span id="FASTA-118"><a href="#FASTA-118"><span class="linenos">118</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="FASTA-119"><a href="#FASTA-119"><span class="linenos">119</span></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span>
</span><span id="FASTA-120"><a href="#FASTA-120"><span class="linenos">120</span></a>        <span class="c1"># Standard case #</span>
</span><span id="FASTA-121"><a href="#FASTA-121"><span class="linenos">121</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="FASTA-122"><a href="#FASTA-122"><span class="linenos">122</span></a>        <span class="c1"># For pickling purposes (can&#39;t use dill on gzip handles) #</span>
</span><span id="FASTA-123"><a href="#FASTA-123"><span class="linenos">123</span></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle</span>
</span><span id="FASTA-124"><a href="#FASTA-124"><span class="linenos">124</span></a>
</span><span id="FASTA-125"><a href="#FASTA-125"><span class="linenos">125</span></a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA-126"><a href="#FASTA-126"><span class="linenos">126</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
</span><span id="FASTA-127"><a href="#FASTA-127"><span class="linenos">127</span></a>        <span class="kn">from</span> <span class="nn">Bio</span> <span class="kn">import</span> <span class="n">SeqIO</span>
</span><span id="FASTA-128"><a href="#FASTA-128"><span class="linenos">128</span></a>        <span class="k">return</span> <span class="n">SeqIO</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
</span><span id="FASTA-129"><a href="#FASTA-129"><span class="linenos">129</span></a>
</span><span id="FASTA-130"><a href="#FASTA-130"><span class="linenos">130</span></a>    <span class="nd">@property</span>
</span><span id="FASTA-131"><a href="#FASTA-131"><span class="linenos">131</span></a>    <span class="k">def</span> <span class="nf">progress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA-132"><a href="#FASTA-132"><span class="linenos">132</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Just like self.parse() but will display a progress bar.&quot;&quot;&quot;</span>
</span><span id="FASTA-133"><a href="#FASTA-133"><span class="linenos">133</span></a>        <span class="k">return</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</span><span id="FASTA-134"><a href="#FASTA-134"><span class="linenos">134</span></a>
</span><span id="FASTA-135"><a href="#FASTA-135"><span class="linenos">135</span></a>    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA-136"><a href="#FASTA-136"><span class="linenos">136</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the file on the file system.&quot;&quot;&quot;</span>
</span><span id="FASTA-137"><a href="#FASTA-137"><span class="linenos">137</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="FASTA-138"><a href="#FASTA-138"><span class="linenos">138</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">buf_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="FASTA-139"><a href="#FASTA-139"><span class="linenos">139</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
</span><span id="FASTA-140"><a href="#FASTA-140"><span class="linenos">140</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span><span id="FASTA-141"><a href="#FASTA-141"><span class="linenos">141</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="FASTA-142"><a href="#FASTA-142"><span class="linenos">142</span></a>
</span><span id="FASTA-143"><a href="#FASTA-143"><span class="linenos">143</span></a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seqs</span><span class="p">):</span>
</span><span id="FASTA-144"><a href="#FASTA-144"><span class="linenos">144</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Use this method to add a bunch of SeqRecords at once.&quot;&quot;&quot;</span>
</span><span id="FASTA-145"><a href="#FASTA-145"><span class="linenos">145</span></a>        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="n">seqs</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_seq</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
</span><span id="FASTA-146"><a href="#FASTA-146"><span class="linenos">146</span></a>
</span><span id="FASTA-147"><a href="#FASTA-147"><span class="linenos">147</span></a>    <span class="k">def</span> <span class="nf">add_seq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span><span class="p">):</span>
</span><span id="FASTA-148"><a href="#FASTA-148"><span class="linenos">148</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Use this method to add a SeqRecord object to this fasta.&quot;&quot;&quot;</span>
</span><span id="FASTA-149"><a href="#FASTA-149"><span class="linenos">149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
</span><span id="FASTA-150"><a href="#FASTA-150"><span class="linenos">150</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">buf_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="FASTA-151"><a href="#FASTA-151"><span class="linenos">151</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">buf_count</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="FASTA-152"><a href="#FASTA-152"><span class="linenos">152</span></a>
</span><span id="FASTA-153"><a href="#FASTA-153"><span class="linenos">153</span></a>    <span class="k">def</span> <span class="nf">add_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="FASTA-154"><a href="#FASTA-154"><span class="linenos">154</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Use this method to add a sequence as a string to this fasta.&quot;&quot;&quot;</span>
</span><span id="FASTA-155"><a href="#FASTA-155"><span class="linenos">155</span></a>        <span class="kn">from</span> <span class="nn">Bio.SeqRecord</span> <span class="kn">import</span> <span class="n">SeqRecord</span>
</span><span id="FASTA-156"><a href="#FASTA-156"><span class="linenos">156</span></a>        <span class="kn">from</span> <span class="nn">Bio.Seq</span> <span class="kn">import</span> <span class="n">Seq</span>
</span><span id="FASTA-157"><a href="#FASTA-157"><span class="linenos">157</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_seq</span><span class="p">(</span><span class="n">SeqRecord</span><span class="p">(</span><span class="n">Seq</span><span class="p">(</span><span class="n">seq</span><span class="p">),</span> <span class="nb">id</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">))</span>
</span><span id="FASTA-158"><a href="#FASTA-158"><span class="linenos">158</span></a>
</span><span id="FASTA-159"><a href="#FASTA-159"><span class="linenos">159</span></a>    <span class="k">def</span> <span class="nf">add_fasta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
</span><span id="FASTA-160"><a href="#FASTA-160"><span class="linenos">160</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Use this method to add an other fasta to this fasta.&quot;&quot;&quot;</span>
</span><span id="FASTA-161"><a href="#FASTA-161"><span class="linenos">161</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">FASTA</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA-162"><a href="#FASTA-162"><span class="linenos">162</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA-163"><a href="#FASTA-163"><span class="linenos">163</span></a>
</span><span id="FASTA-164"><a href="#FASTA-164"><span class="linenos">164</span></a>    <span class="k">def</span> <span class="nf">add_fastas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paths</span><span class="p">):</span>
</span><span id="FASTA-165"><a href="#FASTA-165"><span class="linenos">165</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Use this method to add a bunch of fastas to this fasta.&quot;&quot;&quot;</span>
</span><span id="FASTA-166"><a href="#FASTA-166"><span class="linenos">166</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_fasta</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="FASTA-167"><a href="#FASTA-167"><span class="linenos">167</span></a>
</span><span id="FASTA-168"><a href="#FASTA-168"><span class="linenos">168</span></a>    <span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA-169"><a href="#FASTA-169"><span class="linenos">169</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Empty the buffer.&quot;&quot;&quot;</span>
</span><span id="FASTA-170"><a href="#FASTA-170"><span class="linenos">170</span></a>        <span class="kn">from</span> <span class="nn">Bio</span> <span class="kn">import</span> <span class="n">SeqIO</span>
</span><span id="FASTA-171"><a href="#FASTA-171"><span class="linenos">171</span></a>        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">:</span>
</span><span id="FASTA-172"><a href="#FASTA-172"><span class="linenos">172</span></a>            <span class="n">SeqIO</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
</span><span id="FASTA-173"><a href="#FASTA-173"><span class="linenos">173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="FASTA-174"><a href="#FASTA-174"><span class="linenos">174</span></a>
</span><span id="FASTA-175"><a href="#FASTA-175"><span class="linenos">175</span></a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reads</span><span class="p">):</span>
</span><span id="FASTA-176"><a href="#FASTA-176"><span class="linenos">176</span></a>        <span class="kn">from</span> <span class="nn">Bio</span> <span class="kn">import</span> <span class="n">SeqIO</span>
</span><span id="FASTA-177"><a href="#FASTA-177"><span class="linenos">177</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
</span><span id="FASTA-178"><a href="#FASTA-178"><span class="linenos">178</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span><span id="FASTA-179"><a href="#FASTA-179"><span class="linenos">179</span></a>        <span class="n">SeqIO</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">reads</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
</span><span id="FASTA-180"><a href="#FASTA-180"><span class="linenos">180</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="FASTA-181"><a href="#FASTA-181"><span class="linenos">181</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="FASTA-182"><a href="#FASTA-182"><span class="linenos">182</span></a>
</span><span id="FASTA-183"><a href="#FASTA-183"><span class="linenos">183</span></a>    <span class="c1">#-------------------------- Compressing the data -------------------------#</span>
</span><span id="FASTA-184"><a href="#FASTA-184"><span class="linenos">184</span></a>    <span class="k">def</span> <span class="nf">compress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remove_orig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;slow&#39;</span><span class="p">):</span>
</span><span id="FASTA-185"><a href="#FASTA-185"><span class="linenos">185</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Turn this FASTA file into a gzipped FASTA file.&quot;&quot;&quot;</span>
</span><span id="FASTA-186"><a href="#FASTA-186"><span class="linenos">186</span></a>        <span class="c1"># Check we are not compressed already #</span>
</span><span id="FASTA-187"><a href="#FASTA-187"><span class="linenos">187</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gzipped</span><span class="p">:</span>
</span><span id="FASTA-188"><a href="#FASTA-188"><span class="linenos">188</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;The fasta file &#39;</span><span class="si">%s</span><span class="s2">&#39; is already compressed.&quot;</span>
</span><span id="FASTA-189"><a href="#FASTA-189"><span class="linenos">189</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA-190"><a href="#FASTA-190"><span class="linenos">190</span></a>        <span class="c1"># Pick the new path #</span>
</span><span id="FASTA-191"><a href="#FASTA-191"><span class="linenos">191</span></a>        <span class="k">if</span> <span class="n">new_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">new_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;.gz&#39;</span>
</span><span id="FASTA-192"><a href="#FASTA-192"><span class="linenos">192</span></a>        <span class="c1"># Do it the fast way or the slow way #</span>
</span><span id="FASTA-193"><a href="#FASTA-193"><span class="linenos">193</span></a>        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;fast&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">compress_fast</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="FASTA-194"><a href="#FASTA-194"><span class="linenos">194</span></a>        <span class="k">else</span><span class="p">:</span>                <span class="bp">self</span><span class="o">.</span><span class="n">compress_slow</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="FASTA-195"><a href="#FASTA-195"><span class="linenos">195</span></a>        <span class="c1"># Optionally remove the original uncompressed file #</span>
</span><span id="FASTA-196"><a href="#FASTA-196"><span class="linenos">196</span></a>        <span class="k">if</span> <span class="n">remove_orig</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
</span><span id="FASTA-197"><a href="#FASTA-197"><span class="linenos">197</span></a>        <span class="c1"># Update the internal path #</span>
</span><span id="FASTA-198"><a href="#FASTA-198"><span class="linenos">198</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">new_path</span>
</span><span id="FASTA-199"><a href="#FASTA-199"><span class="linenos">199</span></a>        <span class="c1"># Return #</span>
</span><span id="FASTA-200"><a href="#FASTA-200"><span class="linenos">200</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span>
</span><span id="FASTA-201"><a href="#FASTA-201"><span class="linenos">201</span></a>
</span><span id="FASTA-202"><a href="#FASTA-202"><span class="linenos">202</span></a>    <span class="k">def</span> <span class="nf">compress_slow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_path</span><span class="p">):</span>
</span><span id="FASTA-203"><a href="#FASTA-203"><span class="linenos">203</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Do the compression internally via python.&quot;&quot;&quot;</span>
</span><span id="FASTA-204"><a href="#FASTA-204"><span class="linenos">204</span></a>        <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
</span><span id="FASTA-205"><a href="#FASTA-205"><span class="linenos">205</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;rb&#39;</span><span class="p">),</span> <span class="n">handle</span><span class="p">)</span>
</span><span id="FASTA-206"><a href="#FASTA-206"><span class="linenos">206</span></a>
</span><span id="FASTA-207"><a href="#FASTA-207"><span class="linenos">207</span></a>    <span class="k">def</span> <span class="nf">compress_fast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_path</span><span class="p">):</span>
</span><span id="FASTA-208"><a href="#FASTA-208"><span class="linenos">208</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Do the compression with an external shell command call.&quot;&quot;&quot;</span>
</span><span id="FASTA-209"><a href="#FASTA-209"><span class="linenos">209</span></a>        <span class="c1"># We don&#39;t want python to be buffering the text for speed #</span>
</span><span id="FASTA-210"><a href="#FASTA-210"><span class="linenos">210</span></a>        <span class="kn">from</span> <span class="nn">shell_command</span> <span class="kn">import</span> <span class="n">shell_output</span>
</span><span id="FASTA-211"><a href="#FASTA-211"><span class="linenos">211</span></a>        <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;gzip --stdout </span><span class="si">%s</span><span class="s1"> &gt; </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="FASTA-212"><a href="#FASTA-212"><span class="linenos">212</span></a>        <span class="k">return</span> <span class="n">shell_output</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</span><span id="FASTA-213"><a href="#FASTA-213"><span class="linenos">213</span></a>
</span><span id="FASTA-214"><a href="#FASTA-214"><span class="linenos">214</span></a>    <span class="c1">#------------------------- When IDs are important ------------------------#</span>
</span><span id="FASTA-215"><a href="#FASTA-215"><span class="linenos">215</span></a>    <span class="nd">@property_cached</span>
</span><span id="FASTA-216"><a href="#FASTA-216"><span class="linenos">216</span></a>    <span class="k">def</span> <span class="nf">ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA-217"><a href="#FASTA-217"><span class="linenos">217</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A frozen set of all unique IDs in the file.&quot;&quot;&quot;</span>
</span><span id="FASTA-218"><a href="#FASTA-218"><span class="linenos">218</span></a>        <span class="n">as_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">seq</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
</span><span id="FASTA-219"><a href="#FASTA-219"><span class="linenos">219</span></a>        <span class="n">as_set</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">as_list</span><span class="p">)</span>
</span><span id="FASTA-220"><a href="#FASTA-220"><span class="linenos">220</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">as_set</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">as_list</span><span class="p">)</span>
</span><span id="FASTA-221"><a href="#FASTA-221"><span class="linenos">221</span></a>        <span class="k">return</span> <span class="n">as_set</span>
</span><span id="FASTA-222"><a href="#FASTA-222"><span class="linenos">222</span></a>
</span><span id="FASTA-223"><a href="#FASTA-223"><span class="linenos">223</span></a>    <span class="k">def</span> <span class="nf">get_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">id_num</span><span class="p">):</span>
</span><span id="FASTA-224"><a href="#FASTA-224"><span class="linenos">224</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FASTA-225"><a href="#FASTA-225"><span class="linenos">225</span></a><span class="sd">        Extract one sequence from the file based on its ID.</span>
</span><span id="FASTA-226"><a href="#FASTA-226"><span class="linenos">226</span></a><span class="sd">        This is highly ineffective.</span>
</span><span id="FASTA-227"><a href="#FASTA-227"><span class="linenos">227</span></a><span class="sd">        Consider using the SQLite API instead or memory map the file.</span>
</span><span id="FASTA-228"><a href="#FASTA-228"><span class="linenos">228</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FASTA-229"><a href="#FASTA-229"><span class="linenos">229</span></a>        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="FASTA-230"><a href="#FASTA-230"><span class="linenos">230</span></a>            <span class="k">if</span> <span class="n">seq</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">id_num</span><span class="p">:</span> <span class="k">return</span> <span class="n">seq</span>
</span><span id="FASTA-231"><a href="#FASTA-231"><span class="linenos">231</span></a>
</span><span id="FASTA-232"><a href="#FASTA-232"><span class="linenos">232</span></a>    <span class="nd">@property_cached</span>
</span><span id="FASTA-233"><a href="#FASTA-233"><span class="linenos">233</span></a>    <span class="k">def</span> <span class="nf">sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA-234"><a href="#FASTA-234"><span class="linenos">234</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FASTA-235"><a href="#FASTA-235"><span class="linenos">235</span></a><span class="sd">        Another way of easily retrieving sequences. Also highly ineffective.</span>
</span><span id="FASTA-236"><a href="#FASTA-236"><span class="linenos">236</span></a><span class="sd">        Consider using the SQLite API instead.</span>
</span><span id="FASTA-237"><a href="#FASTA-237"><span class="linenos">237</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FASTA-238"><a href="#FASTA-238"><span class="linenos">238</span></a>        <span class="k">return</span> <span class="n">OrderedDict</span><span class="p">(((</span><span class="n">seq</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">seq</span><span class="p">)</span> <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">))</span>
</span><span id="FASTA-239"><a href="#FASTA-239"><span class="linenos">239</span></a>
</span><span id="FASTA-240"><a href="#FASTA-240"><span class="linenos">240</span></a>    <span class="nd">@property_cached</span>
</span><span id="FASTA-241"><a href="#FASTA-241"><span class="linenos">241</span></a>    <span class="k">def</span> <span class="nf">sql</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA-242"><a href="#FASTA-242"><span class="linenos">242</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FASTA-243"><a href="#FASTA-243"><span class="linenos">243</span></a><span class="sd">        If you access this attribute, we will build an SQLite database</span>
</span><span id="FASTA-244"><a href="#FASTA-244"><span class="linenos">244</span></a><span class="sd">        out of the FASTA file and you will be able access everything in an</span>
</span><span id="FASTA-245"><a href="#FASTA-245"><span class="linenos">245</span></a><span class="sd">        indexed fashion, and use the blaze library via sql.frame</span>
</span><span id="FASTA-246"><a href="#FASTA-246"><span class="linenos">246</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FASTA-247"><a href="#FASTA-247"><span class="linenos">247</span></a>        <span class="kn">from</span> <span class="nn">fasta.indexed</span> <span class="kn">import</span> <span class="n">DatabaseFASTA</span><span class="p">,</span> <span class="n">fasta_to_sql</span>
</span><span id="FASTA-248"><a href="#FASTA-248"><span class="linenos">248</span></a>        <span class="n">db</span> <span class="o">=</span> <span class="n">DatabaseFASTA</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix_path</span> <span class="o">+</span> <span class="s2">&quot;.db&quot;</span><span class="p">)</span>
</span><span id="FASTA-249"><a href="#FASTA-249"><span class="linenos">249</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">db</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span> <span class="n">fasta_to_sql</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA-250"><a href="#FASTA-250"><span class="linenos">250</span></a>        <span class="k">return</span> <span class="n">db</span>
</span><span id="FASTA-251"><a href="#FASTA-251"><span class="linenos">251</span></a>
</span><span id="FASTA-252"><a href="#FASTA-252"><span class="linenos">252</span></a>    <span class="nd">@property_cached</span>
</span><span id="FASTA-253"><a href="#FASTA-253"><span class="linenos">253</span></a>    <span class="k">def</span> <span class="nf">length_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA-254"><a href="#FASTA-254"><span class="linenos">254</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FASTA-255"><a href="#FASTA-255"><span class="linenos">255</span></a><span class="sd">        In some use cases you just need the sequence lengths in an indexed</span>
</span><span id="FASTA-256"><a href="#FASTA-256"><span class="linenos">256</span></a><span class="sd">        fashion. If you access this attribute, we will make a hash map in</span>
</span><span id="FASTA-257"><a href="#FASTA-257"><span class="linenos">257</span></a><span class="sd">        memory.</span>
</span><span id="FASTA-258"><a href="#FASTA-258"><span class="linenos">258</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FASTA-259"><a href="#FASTA-259"><span class="linenos">259</span></a>        <span class="n">hash_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">seq</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">))</span> <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="FASTA-260"><a href="#FASTA-260"><span class="linenos">260</span></a>        <span class="n">tmp</span> <span class="o">=</span> <span class="n">hash_map</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="FASTA-261"><a href="#FASTA-261"><span class="linenos">261</span></a>        <span class="n">hash_map</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
</span><span id="FASTA-262"><a href="#FASTA-262"><span class="linenos">262</span></a>        <span class="k">return</span> <span class="n">hash_map</span>
</span><span id="FASTA-263"><a href="#FASTA-263"><span class="linenos">263</span></a>
</span><span id="FASTA-264"><a href="#FASTA-264"><span class="linenos">264</span></a>    <span class="c1">#----------------- Ways of interacting with the data --------------------#</span>
</span><span id="FASTA-265"><a href="#FASTA-265"><span class="linenos">265</span></a>    <span class="k">def</span> <span class="nf">subsample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">down_to</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="FASTA-266"><a href="#FASTA-266"><span class="linenos">266</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pick a given number of sequences from the file pseudo-randomly.&quot;&quot;&quot;</span>
</span><span id="FASTA-267"><a href="#FASTA-267"><span class="linenos">267</span></a>        <span class="c1"># Pick the destination path #</span>
</span><span id="FASTA-268"><a href="#FASTA-268"><span class="linenos">268</span></a>        <span class="k">if</span> <span class="n">new_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FASTA-269"><a href="#FASTA-269"><span class="linenos">269</span></a>            <span class="n">subsampled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_temp_path</span><span class="p">())</span>
</span><span id="FASTA-270"><a href="#FASTA-270"><span class="linenos">270</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">FASTA</span><span class="p">):</span>
</span><span id="FASTA-271"><a href="#FASTA-271"><span class="linenos">271</span></a>            <span class="n">subsampled</span> <span class="o">=</span> <span class="n">new_path</span>
</span><span id="FASTA-272"><a href="#FASTA-272"><span class="linenos">272</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FASTA-273"><a href="#FASTA-273"><span class="linenos">273</span></a>            <span class="n">subsampled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="FASTA-274"><a href="#FASTA-274"><span class="linenos">274</span></a>        <span class="c1"># Check size #</span>
</span><span id="FASTA-275"><a href="#FASTA-275"><span class="linenos">275</span></a>        <span class="k">if</span> <span class="n">down_to</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA-276"><a href="#FASTA-276"><span class="linenos">276</span></a>            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Can&#39;t subsample </span><span class="si">%s</span><span class="s2"> down to </span><span class="si">%i</span><span class="s2">. Only down to </span><span class="si">%i</span><span class="s2">.&quot;</span>
</span><span id="FASTA-277"><a href="#FASTA-277"><span class="linenos">277</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">Color</span><span class="o">.</span><span class="n">ylw</span> <span class="o">+</span> <span class="n">message</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">down_to</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">+</span> <span class="n">Color</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
</span><span id="FASTA-278"><a href="#FASTA-278"><span class="linenos">278</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="FASTA-279"><a href="#FASTA-279"><span class="linenos">279</span></a>            <span class="k">return</span>
</span><span id="FASTA-280"><a href="#FASTA-280"><span class="linenos">280</span></a>        <span class="c1"># Select verbosity #</span>
</span><span id="FASTA-281"><a href="#FASTA-281"><span class="linenos">281</span></a>        <span class="kn">import</span> <span class="nn">tqdm</span>
</span><span id="FASTA-282"><a href="#FASTA-282"><span class="linenos">282</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="n">wrapper</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
</span><span id="FASTA-283"><a href="#FASTA-283"><span class="linenos">283</span></a>        <span class="k">else</span><span class="p">:</span> <span class="n">wrapper</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
</span><span id="FASTA-284"><a href="#FASTA-284"><span class="linenos">284</span></a>        <span class="c1"># Generator #</span>
</span><span id="FASTA-285"><a href="#FASTA-285"><span class="linenos">285</span></a>        <span class="k">def</span> <span class="nf">iterator</span><span class="p">():</span>
</span><span id="FASTA-286"><a href="#FASTA-286"><span class="linenos">286</span></a>            <span class="k">for</span> <span class="n">read</span> <span class="ow">in</span> <span class="n">wrapper</span><span class="p">(</span><span class="n">isubsample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">down_to</span><span class="p">)):</span>
</span><span id="FASTA-287"><a href="#FASTA-287"><span class="linenos">287</span></a>                <span class="k">yield</span> <span class="n">read</span>
</span><span id="FASTA-288"><a href="#FASTA-288"><span class="linenos">288</span></a>        <span class="c1"># Do it #</span>
</span><span id="FASTA-289"><a href="#FASTA-289"><span class="linenos">289</span></a>        <span class="n">subsampled</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">iterator</span><span class="p">())</span>
</span><span id="FASTA-290"><a href="#FASTA-290"><span class="linenos">290</span></a>        <span class="c1"># Did it work #</span>
</span><span id="FASTA-291"><a href="#FASTA-291"><span class="linenos">291</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">subsampled</span><span class="p">)</span> <span class="o">==</span> <span class="n">down_to</span>
</span><span id="FASTA-292"><a href="#FASTA-292"><span class="linenos">292</span></a>        <span class="c1"># Return #</span>
</span><span id="FASTA-293"><a href="#FASTA-293"><span class="linenos">293</span></a>        <span class="k">return</span> <span class="n">subsampled</span>
</span><span id="FASTA-294"><a href="#FASTA-294"><span class="linenos">294</span></a>
</span><span id="FASTA-295"><a href="#FASTA-295"><span class="linenos">295</span></a>    <span class="k">def</span> <span class="nf">rename_with_num</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remove_desc</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="FASTA-296"><a href="#FASTA-296"><span class="linenos">296</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Rename every sequence based on a prefix and a number.&quot;&quot;&quot;</span>
</span><span id="FASTA-297"><a href="#FASTA-297"><span class="linenos">297</span></a>        <span class="c1"># Temporary path #</span>
</span><span id="FASTA-298"><a href="#FASTA-298"><span class="linenos">298</span></a>        <span class="k">if</span> <span class="n">new_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">numbered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_temp_path</span><span class="p">())</span>
</span><span id="FASTA-299"><a href="#FASTA-299"><span class="linenos">299</span></a>        <span class="k">else</span><span class="p">:</span>                <span class="n">numbered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="FASTA-300"><a href="#FASTA-300"><span class="linenos">300</span></a>        <span class="c1"># Generator #</span>
</span><span id="FASTA-301"><a href="#FASTA-301"><span class="linenos">301</span></a>        <span class="k">def</span> <span class="nf">numbered_iterator</span><span class="p">():</span>
</span><span id="FASTA-302"><a href="#FASTA-302"><span class="linenos">302</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">read</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA-303"><a href="#FASTA-303"><span class="linenos">303</span></a>                <span class="n">read</span><span class="o">.</span><span class="n">id</span>  <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="FASTA-304"><a href="#FASTA-304"><span class="linenos">304</span></a>                <span class="n">read</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span id="FASTA-305"><a href="#FASTA-305"><span class="linenos">305</span></a>                <span class="k">if</span> <span class="n">remove_desc</span><span class="p">:</span> <span class="n">read</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="FASTA-306"><a href="#FASTA-306"><span class="linenos">306</span></a>                <span class="k">yield</span> <span class="n">read</span>
</span><span id="FASTA-307"><a href="#FASTA-307"><span class="linenos">307</span></a>        <span class="c1"># Do it #</span>
</span><span id="FASTA-308"><a href="#FASTA-308"><span class="linenos">308</span></a>        <span class="n">numbered</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">numbered_iterator</span><span class="p">())</span>
</span><span id="FASTA-309"><a href="#FASTA-309"><span class="linenos">309</span></a>        <span class="c1"># Replace it #</span>
</span><span id="FASTA-310"><a href="#FASTA-310"><span class="linenos">310</span></a>        <span class="k">if</span> <span class="n">new_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FASTA-311"><a href="#FASTA-311"><span class="linenos">311</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA-312"><a href="#FASTA-312"><span class="linenos">312</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">numbered</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA-313"><a href="#FASTA-313"><span class="linenos">313</span></a>        <span class="c1"># Return #</span>
</span><span id="FASTA-314"><a href="#FASTA-314"><span class="linenos">314</span></a>        <span class="k">return</span> <span class="n">numbered</span>
</span><span id="FASTA-315"><a href="#FASTA-315"><span class="linenos">315</span></a>
</span><span id="FASTA-316"><a href="#FASTA-316"><span class="linenos">316</span></a>    <span class="k">def</span> <span class="nf">rename_with_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="FASTA-317"><a href="#FASTA-317"><span class="linenos">317</span></a>                           <span class="n">remove_desc</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="FASTA-318"><a href="#FASTA-318"><span class="linenos">318</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Rename every sequence based on a prefix.&quot;&quot;&quot;</span>
</span><span id="FASTA-319"><a href="#FASTA-319"><span class="linenos">319</span></a>        <span class="c1"># Temporary path #</span>
</span><span id="FASTA-320"><a href="#FASTA-320"><span class="linenos">320</span></a>        <span class="k">if</span> <span class="n">new_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">prefixed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_temp_path</span><span class="p">())</span>
</span><span id="FASTA-321"><a href="#FASTA-321"><span class="linenos">321</span></a>        <span class="k">else</span><span class="p">:</span>                <span class="n">prefixed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="FASTA-322"><a href="#FASTA-322"><span class="linenos">322</span></a>        <span class="c1"># Generator #</span>
</span><span id="FASTA-323"><a href="#FASTA-323"><span class="linenos">323</span></a>        <span class="k">def</span> <span class="nf">prefixed_iterator</span><span class="p">():</span>
</span><span id="FASTA-324"><a href="#FASTA-324"><span class="linenos">324</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">read</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA-325"><a href="#FASTA-325"><span class="linenos">325</span></a>                <span class="n">read</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">read</span><span class="o">.</span><span class="n">id</span>
</span><span id="FASTA-326"><a href="#FASTA-326"><span class="linenos">326</span></a>                <span class="k">if</span> <span class="n">remove_desc</span><span class="p">:</span> <span class="n">read</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="FASTA-327"><a href="#FASTA-327"><span class="linenos">327</span></a>                <span class="k">yield</span> <span class="n">read</span>
</span><span id="FASTA-328"><a href="#FASTA-328"><span class="linenos">328</span></a>        <span class="c1"># Do it #</span>
</span><span id="FASTA-329"><a href="#FASTA-329"><span class="linenos">329</span></a>        <span class="n">prefixed</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">prefixed_iterator</span><span class="p">())</span>
</span><span id="FASTA-330"><a href="#FASTA-330"><span class="linenos">330</span></a>        <span class="c1"># Replace it #</span>
</span><span id="FASTA-331"><a href="#FASTA-331"><span class="linenos">331</span></a>        <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
</span><span id="FASTA-332"><a href="#FASTA-332"><span class="linenos">332</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA-333"><a href="#FASTA-333"><span class="linenos">333</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">prefixed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA-334"><a href="#FASTA-334"><span class="linenos">334</span></a>        <span class="c1"># Return #</span>
</span><span id="FASTA-335"><a href="#FASTA-335"><span class="linenos">335</span></a>        <span class="k">return</span> <span class="n">prefixed</span>
</span><span id="FASTA-336"><a href="#FASTA-336"><span class="linenos">336</span></a>
</span><span id="FASTA-337"><a href="#FASTA-337"><span class="linenos">337</span></a>    <span class="k">def</span> <span class="nf">rename_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapping</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="FASTA-338"><a href="#FASTA-338"><span class="linenos">338</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FASTA-339"><a href="#FASTA-339"><span class="linenos">339</span></a><span class="sd">        Will rename all sequences in the current fasta file using</span>
</span><span id="FASTA-340"><a href="#FASTA-340"><span class="linenos">340</span></a><span class="sd">        the mapping dictionary also provided. In place or at a new path.</span>
</span><span id="FASTA-341"><a href="#FASTA-341"><span class="linenos">341</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FASTA-342"><a href="#FASTA-342"><span class="linenos">342</span></a>        <span class="c1"># Where is the new file #</span>
</span><span id="FASTA-343"><a href="#FASTA-343"><span class="linenos">343</span></a>        <span class="k">if</span> <span class="n">new_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">new_fasta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_temp_path</span><span class="p">())</span>
</span><span id="FASTA-344"><a href="#FASTA-344"><span class="linenos">344</span></a>        <span class="k">else</span><span class="p">:</span>                <span class="n">new_fasta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="FASTA-345"><a href="#FASTA-345"><span class="linenos">345</span></a>        <span class="c1"># Do it #</span>
</span><span id="FASTA-346"><a href="#FASTA-346"><span class="linenos">346</span></a>        <span class="n">new_fasta</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
</span><span id="FASTA-347"><a href="#FASTA-347"><span class="linenos">347</span></a>        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="FASTA-348"><a href="#FASTA-348"><span class="linenos">348</span></a>            <span class="n">new_name</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="n">seq</span><span class="o">.</span><span class="n">description</span><span class="p">]</span>
</span><span id="FASTA-349"><a href="#FASTA-349"><span class="linenos">349</span></a>            <span class="n">nucleotides</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">seq</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span>
</span><span id="FASTA-350"><a href="#FASTA-350"><span class="linenos">350</span></a>            <span class="n">new_fasta</span><span class="o">.</span><span class="n">add_str</span><span class="p">(</span><span class="n">nucleotides</span><span class="p">,</span> <span class="n">new_name</span><span class="p">)</span>
</span><span id="FASTA-351"><a href="#FASTA-351"><span class="linenos">351</span></a>        <span class="n">new_fasta</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="FASTA-352"><a href="#FASTA-352"><span class="linenos">352</span></a>        <span class="c1"># Return #</span>
</span><span id="FASTA-353"><a href="#FASTA-353"><span class="linenos">353</span></a>        <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
</span><span id="FASTA-354"><a href="#FASTA-354"><span class="linenos">354</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA-355"><a href="#FASTA-355"><span class="linenos">355</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">new_fasta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA-356"><a href="#FASTA-356"><span class="linenos">356</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="FASTA-357"><a href="#FASTA-357"><span class="linenos">357</span></a>        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">new_fasta</span>
</span><span id="FASTA-358"><a href="#FASTA-358"><span class="linenos">358</span></a>
</span><span id="FASTA-359"><a href="#FASTA-359"><span class="linenos">359</span></a>    <span class="k">def</span> <span class="nf">extract_length</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lower_bound</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="FASTA-360"><a href="#FASTA-360"><span class="linenos">360</span></a>                             <span class="n">upper_bound</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="FASTA-361"><a href="#FASTA-361"><span class="linenos">361</span></a>                             <span class="n">new_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="FASTA-362"><a href="#FASTA-362"><span class="linenos">362</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract a certain length fraction and place them in a new file.&quot;&quot;&quot;</span>
</span><span id="FASTA-363"><a href="#FASTA-363"><span class="linenos">363</span></a>        <span class="c1"># Temporary path #</span>
</span><span id="FASTA-364"><a href="#FASTA-364"><span class="linenos">364</span></a>        <span class="k">if</span> <span class="n">new_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">fraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_temp_path</span><span class="p">())</span>
</span><span id="FASTA-365"><a href="#FASTA-365"><span class="linenos">365</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">FASTA</span><span class="p">):</span> <span class="n">fraction</span> <span class="o">=</span> <span class="n">new_path</span>
</span><span id="FASTA-366"><a href="#FASTA-366"><span class="linenos">366</span></a>        <span class="k">else</span><span class="p">:</span>                <span class="n">fraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="FASTA-367"><a href="#FASTA-367"><span class="linenos">367</span></a>        <span class="c1"># Generator #</span>
</span><span id="FASTA-368"><a href="#FASTA-368"><span class="linenos">368</span></a>        <span class="k">if</span> <span class="n">lower_bound</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">lower_bound</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="FASTA-369"><a href="#FASTA-369"><span class="linenos">369</span></a>        <span class="k">if</span> <span class="n">upper_bound</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span>
</span><span id="FASTA-370"><a href="#FASTA-370"><span class="linenos">370</span></a>        <span class="k">def</span> <span class="nf">fraction_iterator</span><span class="p">():</span>
</span><span id="FASTA-371"><a href="#FASTA-371"><span class="linenos">371</span></a>            <span class="k">for</span> <span class="n">read</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="FASTA-372"><a href="#FASTA-372"><span class="linenos">372</span></a>                <span class="k">if</span> <span class="n">lower_bound</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">read</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">upper_bound</span><span class="p">:</span>
</span><span id="FASTA-373"><a href="#FASTA-373"><span class="linenos">373</span></a>                    <span class="k">yield</span> <span class="n">read</span>
</span><span id="FASTA-374"><a href="#FASTA-374"><span class="linenos">374</span></a>        <span class="c1"># Do it #</span>
</span><span id="FASTA-375"><a href="#FASTA-375"><span class="linenos">375</span></a>        <span class="n">fraction</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fraction_iterator</span><span class="p">())</span>
</span><span id="FASTA-376"><a href="#FASTA-376"><span class="linenos">376</span></a>        <span class="c1"># Return #</span>
</span><span id="FASTA-377"><a href="#FASTA-377"><span class="linenos">377</span></a>        <span class="k">return</span> <span class="n">fraction</span>
</span><span id="FASTA-378"><a href="#FASTA-378"><span class="linenos">378</span></a>
</span><span id="FASTA-379"><a href="#FASTA-379"><span class="linenos">379</span></a>    <span class="k">def</span> <span class="nf">extract_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span>
</span><span id="FASTA-380"><a href="#FASTA-380"><span class="linenos">380</span></a>                          <span class="n">new_path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="FASTA-381"><a href="#FASTA-381"><span class="linenos">381</span></a>                          <span class="n">in_place</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="FASTA-382"><a href="#FASTA-382"><span class="linenos">382</span></a>                          <span class="n">verbose</span>  <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="FASTA-383"><a href="#FASTA-383"><span class="linenos">383</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FASTA-384"><a href="#FASTA-384"><span class="linenos">384</span></a><span class="sd">        Will take all the sequences from the current file who&#39;s id appears in</span>
</span><span id="FASTA-385"><a href="#FASTA-385"><span class="linenos">385</span></a><span class="sd">        the ids given and place them in a new file.</span>
</span><span id="FASTA-386"><a href="#FASTA-386"><span class="linenos">386</span></a><span class="sd">        If no path is given, a new temporary path is created and returned.</span>
</span><span id="FASTA-387"><a href="#FASTA-387"><span class="linenos">387</span></a><span class="sd">        If `in_place` is set to True, the original file is removed and replaced</span>
</span><span id="FASTA-388"><a href="#FASTA-388"><span class="linenos">388</span></a><span class="sd">        with the result of the extraction.</span>
</span><span id="FASTA-389"><a href="#FASTA-389"><span class="linenos">389</span></a><span class="sd">        Optionally, the argument `ids` can be a function which has to take</span>
</span><span id="FASTA-390"><a href="#FASTA-390"><span class="linenos">390</span></a><span class="sd">        one string as only input and return True for keeping the sequence and</span>
</span><span id="FASTA-391"><a href="#FASTA-391"><span class="linenos">391</span></a><span class="sd">        False for discarding the sequence.</span>
</span><span id="FASTA-392"><a href="#FASTA-392"><span class="linenos">392</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FASTA-393"><a href="#FASTA-393"><span class="linenos">393</span></a>        <span class="c1"># Temporary path #</span>
</span><span id="FASTA-394"><a href="#FASTA-394"><span class="linenos">394</span></a>        <span class="k">if</span> <span class="n">new_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">new_fasta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_temp_path</span><span class="p">())</span>
</span><span id="FASTA-395"><a href="#FASTA-395"><span class="linenos">395</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">FASTA</span><span class="p">):</span> <span class="n">new_fasta</span> <span class="o">=</span> <span class="n">new_path</span>
</span><span id="FASTA-396"><a href="#FASTA-396"><span class="linenos">396</span></a>        <span class="k">else</span><span class="p">:</span>                <span class="n">new_fasta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="FASTA-397"><a href="#FASTA-397"><span class="linenos">397</span></a>        <span class="c1"># Select verbosity #</span>
</span><span id="FASTA-398"><a href="#FASTA-398"><span class="linenos">398</span></a>        <span class="kn">import</span> <span class="nn">tqdm</span>
</span><span id="FASTA-399"><a href="#FASTA-399"><span class="linenos">399</span></a>        <span class="n">wrapper</span> <span class="o">=</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span> <span class="k">if</span> <span class="n">verbose</span> <span class="k">else</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
</span><span id="FASTA-400"><a href="#FASTA-400"><span class="linenos">400</span></a>        <span class="c1"># Simple generator #</span>
</span><span id="FASTA-401"><a href="#FASTA-401"><span class="linenos">401</span></a>        <span class="k">def</span> <span class="nf">simple_match</span><span class="p">(</span><span class="n">reads</span><span class="p">):</span>
</span><span id="FASTA-402"><a href="#FASTA-402"><span class="linenos">402</span></a>            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">wrapper</span><span class="p">(</span><span class="n">reads</span><span class="p">):</span>
</span><span id="FASTA-403"><a href="#FASTA-403"><span class="linenos">403</span></a>                <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span> <span class="k">yield</span> <span class="n">r</span>
</span><span id="FASTA-404"><a href="#FASTA-404"><span class="linenos">404</span></a>        <span class="c1"># Generator with function #</span>
</span><span id="FASTA-405"><a href="#FASTA-405"><span class="linenos">405</span></a>        <span class="k">def</span> <span class="nf">function_match</span><span class="p">(</span><span class="n">reads</span><span class="p">):</span>
</span><span id="FASTA-406"><a href="#FASTA-406"><span class="linenos">406</span></a>            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">wrapper</span><span class="p">(</span><span class="n">reads</span><span class="p">):</span>
</span><span id="FASTA-407"><a href="#FASTA-407"><span class="linenos">407</span></a>                <span class="k">if</span> <span class="n">ids</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">id</span><span class="p">):</span> <span class="k">yield</span> <span class="n">r</span>
</span><span id="FASTA-408"><a href="#FASTA-408"><span class="linenos">408</span></a>        <span class="c1"># Do it #</span>
</span><span id="FASTA-409"><a href="#FASTA-409"><span class="linenos">409</span></a>        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">ids</span><span class="p">):</span>
</span><span id="FASTA-410"><a href="#FASTA-410"><span class="linenos">410</span></a>            <span class="n">new_fasta</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">function_match</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</span><span id="FASTA-411"><a href="#FASTA-411"><span class="linenos">411</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FASTA-412"><a href="#FASTA-412"><span class="linenos">412</span></a>            <span class="n">new_fasta</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">simple_match</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</span><span id="FASTA-413"><a href="#FASTA-413"><span class="linenos">413</span></a>        <span class="c1"># Return #</span>
</span><span id="FASTA-414"><a href="#FASTA-414"><span class="linenos">414</span></a>        <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
</span><span id="FASTA-415"><a href="#FASTA-415"><span class="linenos">415</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA-416"><a href="#FASTA-416"><span class="linenos">416</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">new_fasta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA-417"><a href="#FASTA-417"><span class="linenos">417</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="FASTA-418"><a href="#FASTA-418"><span class="linenos">418</span></a>        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">new_fasta</span>
</span><span id="FASTA-419"><a href="#FASTA-419"><span class="linenos">419</span></a>
</span><span id="FASTA-420"><a href="#FASTA-420"><span class="linenos">420</span></a>    <span class="k">def</span> <span class="nf">remove_trailing_stars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="FASTA-421"><a href="#FASTA-421"><span class="linenos">421</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FASTA-422"><a href="#FASTA-422"><span class="linenos">422</span></a><span class="sd">        Remove the bad character that can be inserted by some programs at the</span>
</span><span id="FASTA-423"><a href="#FASTA-423"><span class="linenos">423</span></a><span class="sd">        end of sequences.</span>
</span><span id="FASTA-424"><a href="#FASTA-424"><span class="linenos">424</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FASTA-425"><a href="#FASTA-425"><span class="linenos">425</span></a>        <span class="c1"># Optional check #</span>
</span><span id="FASTA-426"><a href="#FASTA-426"><span class="linenos">426</span></a>        <span class="k">if</span> <span class="n">check</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">sh</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">*&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">_ok_code</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="FASTA-427"><a href="#FASTA-427"><span class="linenos">427</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="FASTA-428"><a href="#FASTA-428"><span class="linenos">428</span></a>        <span class="c1"># Faster with bash utilities #</span>
</span><span id="FASTA-429"><a href="#FASTA-429"><span class="linenos">429</span></a>        <span class="k">if</span> <span class="n">in_place</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="FASTA-430"><a href="#FASTA-430"><span class="linenos">430</span></a>            <span class="n">sh</span><span class="o">.</span><span class="n">sed</span><span class="p">(</span><span class="s1">&#39;-i&#39;</span><span class="p">,</span> <span class="s1">&#39;s/</span><span class="se">\\</span><span class="s1">*$//g&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA-431"><a href="#FASTA-431"><span class="linenos">431</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="FASTA-432"><a href="#FASTA-432"><span class="linenos">432</span></a>        <span class="c1"># Standard way #</span>
</span><span id="FASTA-433"><a href="#FASTA-433"><span class="linenos">433</span></a>        <span class="k">if</span> <span class="n">new_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">new_fasta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_temp_path</span><span class="p">())</span>
</span><span id="FASTA-434"><a href="#FASTA-434"><span class="linenos">434</span></a>        <span class="k">else</span><span class="p">:</span>                <span class="n">new_fasta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="FASTA-435"><a href="#FASTA-435"><span class="linenos">435</span></a>        <span class="n">new_fasta</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
</span><span id="FASTA-436"><a href="#FASTA-436"><span class="linenos">436</span></a>        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span> <span class="n">new_fasta</span><span class="o">.</span><span class="n">add_str</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">seq</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">),</span> <span class="n">seq</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span id="FASTA-437"><a href="#FASTA-437"><span class="linenos">437</span></a>        <span class="n">new_fasta</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="FASTA-438"><a href="#FASTA-438"><span class="linenos">438</span></a>        <span class="c1"># Return #</span>
</span><span id="FASTA-439"><a href="#FASTA-439"><span class="linenos">439</span></a>        <span class="k">return</span> <span class="n">new_fasta</span>
</span><span id="FASTA-440"><a href="#FASTA-440"><span class="linenos">440</span></a>
</span><span id="FASTA-441"><a href="#FASTA-441"><span class="linenos">441</span></a>    <span class="k">def</span> <span class="nf">_generator_mod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="FASTA-442"><a href="#FASTA-442"><span class="linenos">442</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FASTA-443"><a href="#FASTA-443"><span class="linenos">443</span></a><span class="sd">        Generic way of modifying the current fasta either in place or</span>
</span><span id="FASTA-444"><a href="#FASTA-444"><span class="linenos">444</span></a><span class="sd">        with a new destination pass.</span>
</span><span id="FASTA-445"><a href="#FASTA-445"><span class="linenos">445</span></a><span class="sd">        Simply, pass a generator function that will yield the new sequences</span>
</span><span id="FASTA-446"><a href="#FASTA-446"><span class="linenos">446</span></a><span class="sd">        given the current ones.</span>
</span><span id="FASTA-447"><a href="#FASTA-447"><span class="linenos">447</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FASTA-448"><a href="#FASTA-448"><span class="linenos">448</span></a>        <span class="c1"># Temporary path #</span>
</span><span id="FASTA-449"><a href="#FASTA-449"><span class="linenos">449</span></a>        <span class="k">if</span> <span class="n">new_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">new_fasta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_temp_path</span><span class="p">())</span>
</span><span id="FASTA-450"><a href="#FASTA-450"><span class="linenos">450</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">FASTA</span><span class="p">):</span> <span class="n">new_fasta</span> <span class="o">=</span> <span class="n">new_path</span>
</span><span id="FASTA-451"><a href="#FASTA-451"><span class="linenos">451</span></a>        <span class="k">else</span><span class="p">:</span> <span class="n">new_fasta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="FASTA-452"><a href="#FASTA-452"><span class="linenos">452</span></a>        <span class="c1"># Do it #</span>
</span><span id="FASTA-453"><a href="#FASTA-453"><span class="linenos">453</span></a>        <span class="n">new_fasta</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">generator</span><span class="p">())</span>
</span><span id="FASTA-454"><a href="#FASTA-454"><span class="linenos">454</span></a>        <span class="c1"># Return #</span>
</span><span id="FASTA-455"><a href="#FASTA-455"><span class="linenos">455</span></a>        <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
</span><span id="FASTA-456"><a href="#FASTA-456"><span class="linenos">456</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA-457"><a href="#FASTA-457"><span class="linenos">457</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">new_fasta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA-458"><a href="#FASTA-458"><span class="linenos">458</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="FASTA-459"><a href="#FASTA-459"><span class="linenos">459</span></a>        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">new_fasta</span>
</span><span id="FASTA-460"><a href="#FASTA-460"><span class="linenos">460</span></a>
</span><span id="FASTA-461"><a href="#FASTA-461"><span class="linenos">461</span></a>    <span class="k">def</span> <span class="nf">remove_duplicates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="FASTA-462"><a href="#FASTA-462"><span class="linenos">462</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FASTA-463"><a href="#FASTA-463"><span class="linenos">463</span></a><span class="sd">        If several entries have the same ID in the FASTA file, keep only the</span>
</span><span id="FASTA-464"><a href="#FASTA-464"><span class="linenos">464</span></a><span class="sd">        first appearance and remove all the others.</span>
</span><span id="FASTA-465"><a href="#FASTA-465"><span class="linenos">465</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FASTA-466"><a href="#FASTA-466"><span class="linenos">466</span></a>        <span class="c1"># Generator #</span>
</span><span id="FASTA-467"><a href="#FASTA-467"><span class="linenos">467</span></a>        <span class="k">def</span> <span class="nf">unique_entries</span><span class="p">():</span>
</span><span id="FASTA-468"><a href="#FASTA-468"><span class="linenos">468</span></a>            <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="FASTA-469"><a href="#FASTA-469"><span class="linenos">469</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">read</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA-470"><a href="#FASTA-470"><span class="linenos">470</span></a>                <span class="k">if</span> <span class="n">read</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span> <span class="k">continue</span>
</span><span id="FASTA-471"><a href="#FASTA-471"><span class="linenos">471</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="FASTA-472"><a href="#FASTA-472"><span class="linenos">472</span></a>                    <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">read</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span id="FASTA-473"><a href="#FASTA-473"><span class="linenos">473</span></a>                    <span class="k">yield</span> <span class="n">read</span>
</span><span id="FASTA-474"><a href="#FASTA-474"><span class="linenos">474</span></a>        <span class="c1"># Return #</span>
</span><span id="FASTA-475"><a href="#FASTA-475"><span class="linenos">475</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generator_mod</span><span class="p">(</span><span class="n">unique_entries</span><span class="p">,</span> <span class="n">new_path</span><span class="p">,</span> <span class="n">in_place</span><span class="p">)</span>
</span><span id="FASTA-476"><a href="#FASTA-476"><span class="linenos">476</span></a>
</span><span id="FASTA-477"><a href="#FASTA-477"><span class="linenos">477</span></a>    <span class="k">def</span> <span class="nf">convert_U_to_T</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="FASTA-478"><a href="#FASTA-478"><span class="linenos">478</span></a>        <span class="c1"># Generator #</span>
</span><span id="FASTA-479"><a href="#FASTA-479"><span class="linenos">479</span></a>        <span class="k">def</span> <span class="nf">all_U_to_T</span><span class="p">():</span>
</span><span id="FASTA-480"><a href="#FASTA-480"><span class="linenos">480</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">read</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA-481"><a href="#FASTA-481"><span class="linenos">481</span></a>                <span class="n">read</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">back_transcribe</span><span class="p">()</span>
</span><span id="FASTA-482"><a href="#FASTA-482"><span class="linenos">482</span></a>                <span class="k">yield</span> <span class="n">read</span>
</span><span id="FASTA-483"><a href="#FASTA-483"><span class="linenos">483</span></a>        <span class="c1"># Return #</span>
</span><span id="FASTA-484"><a href="#FASTA-484"><span class="linenos">484</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generator_mod</span><span class="p">(</span><span class="n">all_U_to_T</span><span class="p">,</span> <span class="n">new_path</span><span class="p">,</span> <span class="n">in_place</span><span class="p">)</span>
</span><span id="FASTA-485"><a href="#FASTA-485"><span class="linenos">485</span></a>
</span><span id="FASTA-486"><a href="#FASTA-486"><span class="linenos">486</span></a>    <span class="c1">#---------------------------- Third party programs -----------------------#</span>
</span><span id="FASTA-487"><a href="#FASTA-487"><span class="linenos">487</span></a>    <span class="k">def</span> <span class="nf">align</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="FASTA-488"><a href="#FASTA-488"><span class="linenos">488</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;We align the sequences in the fasta file with muscle.&quot;&quot;&quot;</span>
</span><span id="FASTA-489"><a href="#FASTA-489"><span class="linenos">489</span></a>        <span class="k">if</span> <span class="n">out_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">out_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix_path</span> <span class="o">+</span> <span class="s1">&#39;.aln&#39;</span>
</span><span id="FASTA-490"><a href="#FASTA-490"><span class="linenos">490</span></a>        <span class="n">sh</span><span class="o">.</span><span class="n">muscle38</span><span class="p">(</span><span class="s2">&quot;-in&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;-out&quot;</span><span class="p">,</span> <span class="n">out_path</span><span class="p">)</span>
</span><span id="FASTA-491"><a href="#FASTA-491"><span class="linenos">491</span></a>        <span class="kn">from</span> <span class="nn">fasta.aligned</span> <span class="kn">import</span> <span class="n">AlignedFASTA</span>
</span><span id="FASTA-492"><a href="#FASTA-492"><span class="linenos">492</span></a>        <span class="k">return</span> <span class="n">AlignedFASTA</span><span class="p">(</span><span class="n">out_path</span><span class="p">)</span>
</span><span id="FASTA-493"><a href="#FASTA-493"><span class="linenos">493</span></a>
</span><span id="FASTA-494"><a href="#FASTA-494"><span class="linenos">494</span></a>    <span class="k">def</span> <span class="nf">template_align</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_path</span><span class="p">):</span>
</span><span id="FASTA-495"><a href="#FASTA-495"><span class="linenos">495</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FASTA-496"><a href="#FASTA-496"><span class="linenos">496</span></a><span class="sd">        We align the sequences in the fasta file with mothur and a template.</span>
</span><span id="FASTA-497"><a href="#FASTA-497"><span class="linenos">497</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FASTA-498"><a href="#FASTA-498"><span class="linenos">498</span></a>        <span class="c1"># Run it #</span>
</span><span id="FASTA-499"><a href="#FASTA-499"><span class="linenos">499</span></a>        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;#align.seqs(candidate=</span><span class="si">%s</span><span class="s2">, template=</span><span class="si">%s</span><span class="s2">, search=blast,&quot;</span> \
</span><span id="FASTA-500"><a href="#FASTA-500"><span class="linenos">500</span></a>              <span class="s2">&quot;flip=false, processors=8);&quot;</span>
</span><span id="FASTA-501"><a href="#FASTA-501"><span class="linenos">501</span></a>        <span class="n">sh</span><span class="o">.</span><span class="n">mothur</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">ref_path</span><span class="p">))</span>
</span><span id="FASTA-502"><a href="#FASTA-502"><span class="linenos">502</span></a>        <span class="c1"># Move things #</span>
</span><span id="FASTA-503"><a href="#FASTA-503"><span class="linenos">503</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.align&#39;</span><span class="p">,</span>        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">aligned</span><span class="p">)</span>
</span><span id="FASTA-504"><a href="#FASTA-504"><span class="linenos">504</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.align.report&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">report</span><span class="p">)</span>
</span><span id="FASTA-505"><a href="#FASTA-505"><span class="linenos">505</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.flip.accnos&#39;</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">accnos</span><span class="p">)</span>
</span><span id="FASTA-506"><a href="#FASTA-506"><span class="linenos">506</span></a>        <span class="c1"># Clean up #</span>
</span><span id="FASTA-507"><a href="#FASTA-507"><span class="linenos">507</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;formatdb.log&#39;</span><span class="p">):</span>
</span><span id="FASTA-508"><a href="#FASTA-508"><span class="linenos">508</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;formatdb.log&#39;</span><span class="p">)</span>
</span><span id="FASTA-509"><a href="#FASTA-509"><span class="linenos">509</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;error.log&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="s1">&#39;error.log&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="FASTA-510"><a href="#FASTA-510"><span class="linenos">510</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;error.log&#39;</span><span class="p">)</span>
</span><span id="FASTA-511"><a href="#FASTA-511"><span class="linenos">511</span></a>        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">sh</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;mothur.*.logfile&#39;</span><span class="p">):</span>
</span><span id="FASTA-512"><a href="#FASTA-512"><span class="linenos">512</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA-513"><a href="#FASTA-513"><span class="linenos">513</span></a>        <span class="c1"># Return #</span>
</span><span id="FASTA-514"><a href="#FASTA-514"><span class="linenos">514</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">aligned</span>
</span><span id="FASTA-515"><a href="#FASTA-515"><span class="linenos">515</span></a>
</span><span id="FASTA-516"><a href="#FASTA-516"><span class="linenos">516</span></a>    <span class="k">def</span> <span class="nf">index_bowtie</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA-517"><a href="#FASTA-517"><span class="linenos">517</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an index on the fasta file compatible with bowtie2.&quot;&quot;&quot;</span>
</span><span id="FASTA-518"><a href="#FASTA-518"><span class="linenos">518</span></a>        <span class="c1"># It returns exit code 1 if the fasta is empty #</span>
</span><span id="FASTA-519"><a href="#FASTA-519"><span class="linenos">519</span></a>        <span class="k">assert</span> <span class="bp">self</span>
</span><span id="FASTA-520"><a href="#FASTA-520"><span class="linenos">520</span></a>        <span class="c1"># Call the bowtie executable #</span>
</span><span id="FASTA-521"><a href="#FASTA-521"><span class="linenos">521</span></a>        <span class="n">sh</span><span class="o">.</span><span class="n">bowtie2_build</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA-522"><a href="#FASTA-522"><span class="linenos">522</span></a>        <span class="k">return</span> <span class="n">FilePath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;.1.bt2&#39;</span><span class="p">)</span>
</span><span id="FASTA-523"><a href="#FASTA-523"><span class="linenos">523</span></a>
</span><span id="FASTA-524"><a href="#FASTA-524"><span class="linenos">524</span></a>    <span class="k">def</span> <span class="nf">index_samtools</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA-525"><a href="#FASTA-525"><span class="linenos">525</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an index on the fasta file compatible with samtools.&quot;&quot;&quot;</span>
</span><span id="FASTA-526"><a href="#FASTA-526"><span class="linenos">526</span></a>        <span class="n">sh</span><span class="o">.</span><span class="n">samtools</span><span class="p">(</span><span class="s1">&#39;faidx&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA-527"><a href="#FASTA-527"><span class="linenos">527</span></a>        <span class="k">return</span> <span class="n">FilePath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;.fai&#39;</span><span class="p">)</span>
</span><span id="FASTA-528"><a href="#FASTA-528"><span class="linenos">528</span></a>
</span><span id="FASTA-529"><a href="#FASTA-529"><span class="linenos">529</span></a>    <span class="c1">#--------------------------------- Graphs --------------------------------#</span>
</span><span id="FASTA-530"><a href="#FASTA-530"><span class="linenos">530</span></a>    <span class="nd">@property_cached</span>
</span><span id="FASTA-531"><a href="#FASTA-531"><span class="linenos">531</span></a>    <span class="k">def</span> <span class="nf">graphs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA-532"><a href="#FASTA-532"><span class="linenos">532</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FASTA-533"><a href="#FASTA-533"><span class="linenos">533</span></a><span class="sd">        Sorry for the black magic. The result is an object whose attributes</span>
</span><span id="FASTA-534"><a href="#FASTA-534"><span class="linenos">534</span></a><span class="sd">        are all the graphs found in `./graphs.py` initialized with this</span>
</span><span id="FASTA-535"><a href="#FASTA-535"><span class="linenos">535</span></a><span class="sd">        instance as only argument.</span>
</span><span id="FASTA-536"><a href="#FASTA-536"><span class="linenos">536</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FASTA-537"><a href="#FASTA-537"><span class="linenos">537</span></a>        <span class="c1"># Make a dummy object #</span>
</span><span id="FASTA-538"><a href="#FASTA-538"><span class="linenos">538</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">Dummy</span><span class="p">()</span>
</span><span id="FASTA-539"><a href="#FASTA-539"><span class="linenos">539</span></a>        <span class="c1"># Loop over graphs #</span>
</span><span id="FASTA-540"><a href="#FASTA-540"><span class="linenos">540</span></a>        <span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="n">graphs</span><span class="o">.</span><span class="n">__all__</span><span class="p">:</span>
</span><span id="FASTA-541"><a href="#FASTA-541"><span class="linenos">541</span></a>            <span class="bp">cls</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">graphs</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
</span><span id="FASTA-542"><a href="#FASTA-542"><span class="linenos">542</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">short_name</span><span class="p">,</span> <span class="bp">cls</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</span><span id="FASTA-543"><a href="#FASTA-543"><span class="linenos">543</span></a>        <span class="c1"># Return #</span>
</span><span id="FASTA-544"><a href="#FASTA-544"><span class="linenos">544</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="FASTA-545"><a href="#FASTA-545"><span class="linenos">545</span></a>
</span><span id="FASTA-546"><a href="#FASTA-546"><span class="linenos">546</span></a>    <span class="c1">#-------------------------------- Primers -------------------------------#</span>
</span><span id="FASTA-547"><a href="#FASTA-547"><span class="linenos">547</span></a>    <span class="k">def</span> <span class="nf">parse_primers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">primers</span><span class="p">,</span> <span class="n">mismatches</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="FASTA-548"><a href="#FASTA-548"><span class="linenos">548</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FASTA-549"><a href="#FASTA-549"><span class="linenos">549</span></a><span class="sd">        Takes care of identifying primers inside every sequence.</span>
</span><span id="FASTA-550"><a href="#FASTA-550"><span class="linenos">550</span></a><span class="sd">        Instead of yielding Seq objects now we yield ReadWithPrimers objects.</span>
</span><span id="FASTA-551"><a href="#FASTA-551"><span class="linenos">551</span></a><span class="sd">        These have extra properties that show the start and end positions</span>
</span><span id="FASTA-552"><a href="#FASTA-552"><span class="linenos">552</span></a><span class="sd">        of all primers found.</span>
</span><span id="FASTA-553"><a href="#FASTA-553"><span class="linenos">553</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FASTA-554"><a href="#FASTA-554"><span class="linenos">554</span></a>        <span class="c1"># Default is zero #</span>
</span><span id="FASTA-555"><a href="#FASTA-555"><span class="linenos">555</span></a>        <span class="k">if</span> <span class="n">mismatches</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">mismatches</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="FASTA-556"><a href="#FASTA-556"><span class="linenos">556</span></a>        <span class="c1"># Get the search expressions with mismatches #</span>
</span><span id="FASTA-557"><a href="#FASTA-557"><span class="linenos">557</span></a>        <span class="kn">from</span> <span class="nn">fasta.primers</span> <span class="kn">import</span> <span class="n">PrimersRegexes</span>
</span><span id="FASTA-558"><a href="#FASTA-558"><span class="linenos">558</span></a>        <span class="n">regexes</span> <span class="o">=</span> <span class="n">PrimersRegexes</span><span class="p">(</span><span class="n">primers</span><span class="p">,</span> <span class="n">mismatches</span><span class="p">)</span>
</span><span id="FASTA-559"><a href="#FASTA-559"><span class="linenos">559</span></a>        <span class="c1"># Generate a new special object for every read #</span>
</span><span id="FASTA-560"><a href="#FASTA-560"><span class="linenos">560</span></a>        <span class="kn">from</span> <span class="nn">fasta.primers</span> <span class="kn">import</span> <span class="n">ReadWithPrimers</span>
</span><span id="FASTA-561"><a href="#FASTA-561"><span class="linenos">561</span></a>        <span class="n">read_with_primer</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">read</span><span class="p">:</span> <span class="n">ReadWithPrimers</span><span class="p">(</span><span class="n">read</span><span class="p">,</span> <span class="n">regexes</span><span class="p">)</span>
</span><span id="FASTA-562"><a href="#FASTA-562"><span class="linenos">562</span></a>        <span class="n">generator</span> <span class="o">=</span> <span class="p">(</span><span class="n">read_with_primer</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">())</span>
</span><span id="FASTA-563"><a href="#FASTA-563"><span class="linenos">563</span></a>        <span class="c1"># Add the length to the generator #</span>
</span><span id="FASTA-564"><a href="#FASTA-564"><span class="linenos">564</span></a>        <span class="kn">from</span> <span class="nn">plumbing.common</span> <span class="kn">import</span> <span class="n">GenWithLength</span>
</span><span id="FASTA-565"><a href="#FASTA-565"><span class="linenos">565</span></a>        <span class="n">generator</span> <span class="o">=</span> <span class="n">GenWithLength</span><span class="p">(</span><span class="n">generator</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</span><span id="FASTA-566"><a href="#FASTA-566"><span class="linenos">566</span></a>        <span class="c1"># Return #</span>
</span><span id="FASTA-567"><a href="#FASTA-567"><span class="linenos">567</span></a>        <span class="k">return</span> <span class="n">generator</span>
</span></pre></div>


            <div class="docstring"><p>A single FASTA file somewhere in the filesystem. You can read from it in
several convenient ways. You can write to it in a automatically buffered
way. There are several other things you can do with a FASTA file.</p>
</div>


                            <div id="FASTA.format" class="classattr">
                                <div class="attr variable">
            <span class="name">format</span>        =
<span class="default_value">&#39;fasta&#39;</span>

        
    </div>
    <a class="headerlink" href="#FASTA.format"></a>
    
    

                            </div>
                            <div id="FASTA.ext" class="classattr">
                                <div class="attr variable">
            <span class="name">ext</span>        =
<span class="default_value">&#39;fasta&#39;</span>

        
    </div>
    <a class="headerlink" href="#FASTA.ext"></a>
    
    

                            </div>
                            <div id="FASTA.buffer_size" class="classattr">
                                <div class="attr variable">
            <span class="name">buffer_size</span>        =
<span class="default_value">1000</span>

        
    </div>
    <a class="headerlink" href="#FASTA.buffer_size"></a>
    
    

                            </div>
                            <div id="FASTA.gzipped" class="classattr">
                                <div class="attr variable">
            <span class="name">gzipped</span>

        
    </div>
    <a class="headerlink" href="#FASTA.gzipped"></a>
    
    

                            </div>
                            <div id="FASTA.first" class="classattr">
                                <div class="attr variable">
            <span class="name">first</span>

        
    </div>
    <a class="headerlink" href="#FASTA.first"></a>
    
            <div class="docstring"><p>Just the first sequence.</p>
</div>


                            </div>
                            <div id="FASTA.count" class="classattr">
                                <div class="attr variable">
            <span class="name">count</span>

        
    </div>
    <a class="headerlink" href="#FASTA.count"></a>
    
            <div class="docstring"><p>Should probably check for file size changes instead of just
caching once TODO.</p>
</div>


                            </div>
                            <div id="FASTA.lengths" class="classattr">
                                <div class="attr variable">
            <span class="name">lengths</span>

        
    </div>
    <a class="headerlink" href="#FASTA.lengths"></a>
    
            <div class="docstring"><p>All the lengths, one by one, in a list.</p>
</div>


                            </div>
                            <div id="FASTA.lengths_counter" class="classattr">
                                <div class="attr variable">
            <span class="name">lengths_counter</span>

        
    </div>
    <a class="headerlink" href="#FASTA.lengths_counter"></a>
    
            <div class="docstring"><p>A Counter() object with all the lengths inside.</p>
</div>


                            </div>
                            <div id="FASTA.open" class="classattr">
                                        <input id="FASTA.open-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">open</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FASTA.open-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA.open"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA.open-105"><a href="#FASTA.open-105"><span class="linenos">105</span></a>    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">):</span>
</span><span id="FASTA.open-106"><a href="#FASTA.open-106"><span class="linenos">106</span></a>        <span class="c1"># Two cases #</span>
</span><span id="FASTA.open-107"><a href="#FASTA.open-107"><span class="linenos">107</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gzipped</span><span class="p">:</span>
</span><span id="FASTA.open-108"><a href="#FASTA.open-108"><span class="linenos">108</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
</span><span id="FASTA.open-109"><a href="#FASTA.open-109"><span class="linenos">109</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
</span><span id="FASTA.open-110"><a href="#FASTA.open-110"><span class="linenos">110</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FASTA.open-111"><a href="#FASTA.open-111"><span class="linenos">111</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
</span><span id="FASTA.open-112"><a href="#FASTA.open-112"><span class="linenos">112</span></a>        <span class="c1"># For convenience #</span>
</span><span id="FASTA.open-113"><a href="#FASTA.open-113"><span class="linenos">113</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle</span>
</span></pre></div>


    

                            </div>
                            <div id="FASTA.close" class="classattr">
                                        <input id="FASTA.close-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">close</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FASTA.close-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA.close"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA.close-115"><a href="#FASTA.close-115"><span class="linenos">115</span></a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA.close-116"><a href="#FASTA.close-116"><span class="linenos">116</span></a>        <span class="c1"># Case we were writing to the file #</span>
</span><span id="FASTA.close-117"><a href="#FASTA.close-117"><span class="linenos">117</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;buffer&#39;</span><span class="p">):</span>
</span><span id="FASTA.close-118"><a href="#FASTA.close-118"><span class="linenos">118</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="FASTA.close-119"><a href="#FASTA.close-119"><span class="linenos">119</span></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span>
</span><span id="FASTA.close-120"><a href="#FASTA.close-120"><span class="linenos">120</span></a>        <span class="c1"># Standard case #</span>
</span><span id="FASTA.close-121"><a href="#FASTA.close-121"><span class="linenos">121</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="FASTA.close-122"><a href="#FASTA.close-122"><span class="linenos">122</span></a>        <span class="c1"># For pickling purposes (can&#39;t use dill on gzip handles) #</span>
</span><span id="FASTA.close-123"><a href="#FASTA.close-123"><span class="linenos">123</span></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle</span>
</span></pre></div>


    

                            </div>
                            <div id="FASTA.parse" class="classattr">
                                        <input id="FASTA.parse-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parse</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FASTA.parse-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA.parse"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA.parse-125"><a href="#FASTA.parse-125"><span class="linenos">125</span></a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA.parse-126"><a href="#FASTA.parse-126"><span class="linenos">126</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
</span><span id="FASTA.parse-127"><a href="#FASTA.parse-127"><span class="linenos">127</span></a>        <span class="kn">from</span> <span class="nn">Bio</span> <span class="kn">import</span> <span class="n">SeqIO</span>
</span><span id="FASTA.parse-128"><a href="#FASTA.parse-128"><span class="linenos">128</span></a>        <span class="k">return</span> <span class="n">SeqIO</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="FASTA.progress" class="classattr">
                                <div class="attr variable">
            <span class="name">progress</span>

        
    </div>
    <a class="headerlink" href="#FASTA.progress"></a>
    
            <div class="docstring"><p>Just like self.parse() but will display a progress bar.</p>
</div>


                            </div>
                            <div id="FASTA.create" class="classattr">
                                        <input id="FASTA.create-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FASTA.create-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA.create"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA.create-135"><a href="#FASTA.create-135"><span class="linenos">135</span></a>    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA.create-136"><a href="#FASTA.create-136"><span class="linenos">136</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the file on the file system.&quot;&quot;&quot;</span>
</span><span id="FASTA.create-137"><a href="#FASTA.create-137"><span class="linenos">137</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="FASTA.create-138"><a href="#FASTA.create-138"><span class="linenos">138</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">buf_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="FASTA.create-139"><a href="#FASTA.create-139"><span class="linenos">139</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
</span><span id="FASTA.create-140"><a href="#FASTA.create-140"><span class="linenos">140</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span><span id="FASTA.create-141"><a href="#FASTA.create-141"><span class="linenos">141</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>Create the file on the file system.</p>
</div>


                            </div>
                            <div id="FASTA.add" class="classattr">
                                        <input id="FASTA.add-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">seqs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FASTA.add-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA.add"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA.add-143"><a href="#FASTA.add-143"><span class="linenos">143</span></a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seqs</span><span class="p">):</span>
</span><span id="FASTA.add-144"><a href="#FASTA.add-144"><span class="linenos">144</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Use this method to add a bunch of SeqRecords at once.&quot;&quot;&quot;</span>
</span><span id="FASTA.add-145"><a href="#FASTA.add-145"><span class="linenos">145</span></a>        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="n">seqs</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_seq</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Use this method to add a bunch of SeqRecords at once.</p>
</div>


                            </div>
                            <div id="FASTA.add_seq" class="classattr">
                                        <input id="FASTA.add_seq-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_seq</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">seq</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FASTA.add_seq-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA.add_seq"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA.add_seq-147"><a href="#FASTA.add_seq-147"><span class="linenos">147</span></a>    <span class="k">def</span> <span class="nf">add_seq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span><span class="p">):</span>
</span><span id="FASTA.add_seq-148"><a href="#FASTA.add_seq-148"><span class="linenos">148</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Use this method to add a SeqRecord object to this fasta.&quot;&quot;&quot;</span>
</span><span id="FASTA.add_seq-149"><a href="#FASTA.add_seq-149"><span class="linenos">149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
</span><span id="FASTA.add_seq-150"><a href="#FASTA.add_seq-150"><span class="linenos">150</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">buf_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="FASTA.add_seq-151"><a href="#FASTA.add_seq-151"><span class="linenos">151</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">buf_count</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Use this method to add a SeqRecord object to this fasta.</p>
</div>


                            </div>
                            <div id="FASTA.add_str" class="classattr">
                                        <input id="FASTA.add_str-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_str</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">seq</span>, </span><span class="param"><span class="n">name</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FASTA.add_str-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA.add_str"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA.add_str-153"><a href="#FASTA.add_str-153"><span class="linenos">153</span></a>    <span class="k">def</span> <span class="nf">add_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="FASTA.add_str-154"><a href="#FASTA.add_str-154"><span class="linenos">154</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Use this method to add a sequence as a string to this fasta.&quot;&quot;&quot;</span>
</span><span id="FASTA.add_str-155"><a href="#FASTA.add_str-155"><span class="linenos">155</span></a>        <span class="kn">from</span> <span class="nn">Bio.SeqRecord</span> <span class="kn">import</span> <span class="n">SeqRecord</span>
</span><span id="FASTA.add_str-156"><a href="#FASTA.add_str-156"><span class="linenos">156</span></a>        <span class="kn">from</span> <span class="nn">Bio.Seq</span> <span class="kn">import</span> <span class="n">Seq</span>
</span><span id="FASTA.add_str-157"><a href="#FASTA.add_str-157"><span class="linenos">157</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_seq</span><span class="p">(</span><span class="n">SeqRecord</span><span class="p">(</span><span class="n">Seq</span><span class="p">(</span><span class="n">seq</span><span class="p">),</span> <span class="nb">id</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Use this method to add a sequence as a string to this fasta.</p>
</div>


                            </div>
                            <div id="FASTA.add_fasta" class="classattr">
                                        <input id="FASTA.add_fasta-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_fasta</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FASTA.add_fasta-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA.add_fasta"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA.add_fasta-159"><a href="#FASTA.add_fasta-159"><span class="linenos">159</span></a>    <span class="k">def</span> <span class="nf">add_fasta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
</span><span id="FASTA.add_fasta-160"><a href="#FASTA.add_fasta-160"><span class="linenos">160</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Use this method to add an other fasta to this fasta.&quot;&quot;&quot;</span>
</span><span id="FASTA.add_fasta-161"><a href="#FASTA.add_fasta-161"><span class="linenos">161</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">FASTA</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA.add_fasta-162"><a href="#FASTA.add_fasta-162"><span class="linenos">162</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Use this method to add an other fasta to this fasta.</p>
</div>


                            </div>
                            <div id="FASTA.add_fastas" class="classattr">
                                        <input id="FASTA.add_fastas-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_fastas</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">paths</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FASTA.add_fastas-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA.add_fastas"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA.add_fastas-164"><a href="#FASTA.add_fastas-164"><span class="linenos">164</span></a>    <span class="k">def</span> <span class="nf">add_fastas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paths</span><span class="p">):</span>
</span><span id="FASTA.add_fastas-165"><a href="#FASTA.add_fastas-165"><span class="linenos">165</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Use this method to add a bunch of fastas to this fasta.&quot;&quot;&quot;</span>
</span><span id="FASTA.add_fastas-166"><a href="#FASTA.add_fastas-166"><span class="linenos">166</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_fasta</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Use this method to add a bunch of fastas to this fasta.</p>
</div>


                            </div>
                            <div id="FASTA.flush" class="classattr">
                                        <input id="FASTA.flush-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">flush</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FASTA.flush-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA.flush"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA.flush-168"><a href="#FASTA.flush-168"><span class="linenos">168</span></a>    <span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA.flush-169"><a href="#FASTA.flush-169"><span class="linenos">169</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Empty the buffer.&quot;&quot;&quot;</span>
</span><span id="FASTA.flush-170"><a href="#FASTA.flush-170"><span class="linenos">170</span></a>        <span class="kn">from</span> <span class="nn">Bio</span> <span class="kn">import</span> <span class="n">SeqIO</span>
</span><span id="FASTA.flush-171"><a href="#FASTA.flush-171"><span class="linenos">171</span></a>        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">:</span>
</span><span id="FASTA.flush-172"><a href="#FASTA.flush-172"><span class="linenos">172</span></a>            <span class="n">SeqIO</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
</span><span id="FASTA.flush-173"><a href="#FASTA.flush-173"><span class="linenos">173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span> <span class="o">=</span> <span class="p">[]</span>
</span></pre></div>


            <div class="docstring"><p>Empty the buffer.</p>
</div>


                            </div>
                            <div id="FASTA.write" class="classattr">
                                        <input id="FASTA.write-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">write</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reads</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FASTA.write-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA.write"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA.write-175"><a href="#FASTA.write-175"><span class="linenos">175</span></a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reads</span><span class="p">):</span>
</span><span id="FASTA.write-176"><a href="#FASTA.write-176"><span class="linenos">176</span></a>        <span class="kn">from</span> <span class="nn">Bio</span> <span class="kn">import</span> <span class="n">SeqIO</span>
</span><span id="FASTA.write-177"><a href="#FASTA.write-177"><span class="linenos">177</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
</span><span id="FASTA.write-178"><a href="#FASTA.write-178"><span class="linenos">178</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span><span id="FASTA.write-179"><a href="#FASTA.write-179"><span class="linenos">179</span></a>        <span class="n">SeqIO</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">reads</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
</span><span id="FASTA.write-180"><a href="#FASTA.write-180"><span class="linenos">180</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="FASTA.write-181"><a href="#FASTA.write-181"><span class="linenos">181</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


    

                            </div>
                            <div id="FASTA.compress" class="classattr">
                                        <input id="FASTA.compress-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compress</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">new_path</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">remove_orig</span><span class="o">=</span><span class="kc">False</span>, </span><span class="param"><span class="n">method</span><span class="o">=</span><span class="s1">&#39;slow&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FASTA.compress-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA.compress"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA.compress-184"><a href="#FASTA.compress-184"><span class="linenos">184</span></a>    <span class="k">def</span> <span class="nf">compress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remove_orig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;slow&#39;</span><span class="p">):</span>
</span><span id="FASTA.compress-185"><a href="#FASTA.compress-185"><span class="linenos">185</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Turn this FASTA file into a gzipped FASTA file.&quot;&quot;&quot;</span>
</span><span id="FASTA.compress-186"><a href="#FASTA.compress-186"><span class="linenos">186</span></a>        <span class="c1"># Check we are not compressed already #</span>
</span><span id="FASTA.compress-187"><a href="#FASTA.compress-187"><span class="linenos">187</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gzipped</span><span class="p">:</span>
</span><span id="FASTA.compress-188"><a href="#FASTA.compress-188"><span class="linenos">188</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;The fasta file &#39;</span><span class="si">%s</span><span class="s2">&#39; is already compressed.&quot;</span>
</span><span id="FASTA.compress-189"><a href="#FASTA.compress-189"><span class="linenos">189</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA.compress-190"><a href="#FASTA.compress-190"><span class="linenos">190</span></a>        <span class="c1"># Pick the new path #</span>
</span><span id="FASTA.compress-191"><a href="#FASTA.compress-191"><span class="linenos">191</span></a>        <span class="k">if</span> <span class="n">new_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">new_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;.gz&#39;</span>
</span><span id="FASTA.compress-192"><a href="#FASTA.compress-192"><span class="linenos">192</span></a>        <span class="c1"># Do it the fast way or the slow way #</span>
</span><span id="FASTA.compress-193"><a href="#FASTA.compress-193"><span class="linenos">193</span></a>        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;fast&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">compress_fast</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="FASTA.compress-194"><a href="#FASTA.compress-194"><span class="linenos">194</span></a>        <span class="k">else</span><span class="p">:</span>                <span class="bp">self</span><span class="o">.</span><span class="n">compress_slow</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="FASTA.compress-195"><a href="#FASTA.compress-195"><span class="linenos">195</span></a>        <span class="c1"># Optionally remove the original uncompressed file #</span>
</span><span id="FASTA.compress-196"><a href="#FASTA.compress-196"><span class="linenos">196</span></a>        <span class="k">if</span> <span class="n">remove_orig</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
</span><span id="FASTA.compress-197"><a href="#FASTA.compress-197"><span class="linenos">197</span></a>        <span class="c1"># Update the internal path #</span>
</span><span id="FASTA.compress-198"><a href="#FASTA.compress-198"><span class="linenos">198</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">new_path</span>
</span><span id="FASTA.compress-199"><a href="#FASTA.compress-199"><span class="linenos">199</span></a>        <span class="c1"># Return #</span>
</span><span id="FASTA.compress-200"><a href="#FASTA.compress-200"><span class="linenos">200</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span>
</span></pre></div>


            <div class="docstring"><p>Turn this FASTA file into a gzipped FASTA file.</p>
</div>


                            </div>
                            <div id="FASTA.compress_slow" class="classattr">
                                        <input id="FASTA.compress_slow-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compress_slow</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">new_path</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FASTA.compress_slow-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA.compress_slow"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA.compress_slow-202"><a href="#FASTA.compress_slow-202"><span class="linenos">202</span></a>    <span class="k">def</span> <span class="nf">compress_slow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_path</span><span class="p">):</span>
</span><span id="FASTA.compress_slow-203"><a href="#FASTA.compress_slow-203"><span class="linenos">203</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Do the compression internally via python.&quot;&quot;&quot;</span>
</span><span id="FASTA.compress_slow-204"><a href="#FASTA.compress_slow-204"><span class="linenos">204</span></a>        <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
</span><span id="FASTA.compress_slow-205"><a href="#FASTA.compress_slow-205"><span class="linenos">205</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;rb&#39;</span><span class="p">),</span> <span class="n">handle</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Do the compression internally via python.</p>
</div>


                            </div>
                            <div id="FASTA.compress_fast" class="classattr">
                                        <input id="FASTA.compress_fast-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compress_fast</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">new_path</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FASTA.compress_fast-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA.compress_fast"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA.compress_fast-207"><a href="#FASTA.compress_fast-207"><span class="linenos">207</span></a>    <span class="k">def</span> <span class="nf">compress_fast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_path</span><span class="p">):</span>
</span><span id="FASTA.compress_fast-208"><a href="#FASTA.compress_fast-208"><span class="linenos">208</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Do the compression with an external shell command call.&quot;&quot;&quot;</span>
</span><span id="FASTA.compress_fast-209"><a href="#FASTA.compress_fast-209"><span class="linenos">209</span></a>        <span class="c1"># We don&#39;t want python to be buffering the text for speed #</span>
</span><span id="FASTA.compress_fast-210"><a href="#FASTA.compress_fast-210"><span class="linenos">210</span></a>        <span class="kn">from</span> <span class="nn">shell_command</span> <span class="kn">import</span> <span class="n">shell_output</span>
</span><span id="FASTA.compress_fast-211"><a href="#FASTA.compress_fast-211"><span class="linenos">211</span></a>        <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;gzip --stdout </span><span class="si">%s</span><span class="s1"> &gt; </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="FASTA.compress_fast-212"><a href="#FASTA.compress_fast-212"><span class="linenos">212</span></a>        <span class="k">return</span> <span class="n">shell_output</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Do the compression with an external shell command call.</p>
</div>


                            </div>
                            <div id="FASTA.ids" class="classattr">
                                <div class="attr variable">
            <span class="name">ids</span>

        
    </div>
    <a class="headerlink" href="#FASTA.ids"></a>
    
            <div class="docstring"><p>A frozen set of all unique IDs in the file.</p>
</div>


                            </div>
                            <div id="FASTA.get_id" class="classattr">
                                        <input id="FASTA.get_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_id</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">id_num</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FASTA.get_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA.get_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA.get_id-223"><a href="#FASTA.get_id-223"><span class="linenos">223</span></a>    <span class="k">def</span> <span class="nf">get_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">id_num</span><span class="p">):</span>
</span><span id="FASTA.get_id-224"><a href="#FASTA.get_id-224"><span class="linenos">224</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FASTA.get_id-225"><a href="#FASTA.get_id-225"><span class="linenos">225</span></a><span class="sd">        Extract one sequence from the file based on its ID.</span>
</span><span id="FASTA.get_id-226"><a href="#FASTA.get_id-226"><span class="linenos">226</span></a><span class="sd">        This is highly ineffective.</span>
</span><span id="FASTA.get_id-227"><a href="#FASTA.get_id-227"><span class="linenos">227</span></a><span class="sd">        Consider using the SQLite API instead or memory map the file.</span>
</span><span id="FASTA.get_id-228"><a href="#FASTA.get_id-228"><span class="linenos">228</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FASTA.get_id-229"><a href="#FASTA.get_id-229"><span class="linenos">229</span></a>        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="FASTA.get_id-230"><a href="#FASTA.get_id-230"><span class="linenos">230</span></a>            <span class="k">if</span> <span class="n">seq</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">id_num</span><span class="p">:</span> <span class="k">return</span> <span class="n">seq</span>
</span></pre></div>


            <div class="docstring"><p>Extract one sequence from the file based on its ID.
This is highly ineffective.
Consider using the SQLite API instead or memory map the file.</p>
</div>


                            </div>
                            <div id="FASTA.sequences" class="classattr">
                                <div class="attr variable">
            <span class="name">sequences</span>

        
    </div>
    <a class="headerlink" href="#FASTA.sequences"></a>
    
            <div class="docstring"><p>Another way of easily retrieving sequences. Also highly ineffective.
Consider using the SQLite API instead.</p>
</div>


                            </div>
                            <div id="FASTA.sql" class="classattr">
                                <div class="attr variable">
            <span class="name">sql</span>

        
    </div>
    <a class="headerlink" href="#FASTA.sql"></a>
    
            <div class="docstring"><p>If you access this attribute, we will build an SQLite database
out of the FASTA file and you will be able access everything in an
indexed fashion, and use the blaze library via sql.frame</p>
</div>


                            </div>
                            <div id="FASTA.length_by_id" class="classattr">
                                <div class="attr variable">
            <span class="name">length_by_id</span>

        
    </div>
    <a class="headerlink" href="#FASTA.length_by_id"></a>
    
            <div class="docstring"><p>In some use cases you just need the sequence lengths in an indexed
fashion. If you access this attribute, we will make a hash map in
memory.</p>
</div>


                            </div>
                            <div id="FASTA.subsample" class="classattr">
                                        <input id="FASTA.subsample-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">subsample</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">down_to</span><span class="o">=</span><span class="mi">1</span>, </span><span class="param"><span class="n">new_path</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FASTA.subsample-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA.subsample"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA.subsample-265"><a href="#FASTA.subsample-265"><span class="linenos">265</span></a>    <span class="k">def</span> <span class="nf">subsample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">down_to</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="FASTA.subsample-266"><a href="#FASTA.subsample-266"><span class="linenos">266</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pick a given number of sequences from the file pseudo-randomly.&quot;&quot;&quot;</span>
</span><span id="FASTA.subsample-267"><a href="#FASTA.subsample-267"><span class="linenos">267</span></a>        <span class="c1"># Pick the destination path #</span>
</span><span id="FASTA.subsample-268"><a href="#FASTA.subsample-268"><span class="linenos">268</span></a>        <span class="k">if</span> <span class="n">new_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FASTA.subsample-269"><a href="#FASTA.subsample-269"><span class="linenos">269</span></a>            <span class="n">subsampled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_temp_path</span><span class="p">())</span>
</span><span id="FASTA.subsample-270"><a href="#FASTA.subsample-270"><span class="linenos">270</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">FASTA</span><span class="p">):</span>
</span><span id="FASTA.subsample-271"><a href="#FASTA.subsample-271"><span class="linenos">271</span></a>            <span class="n">subsampled</span> <span class="o">=</span> <span class="n">new_path</span>
</span><span id="FASTA.subsample-272"><a href="#FASTA.subsample-272"><span class="linenos">272</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FASTA.subsample-273"><a href="#FASTA.subsample-273"><span class="linenos">273</span></a>            <span class="n">subsampled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="FASTA.subsample-274"><a href="#FASTA.subsample-274"><span class="linenos">274</span></a>        <span class="c1"># Check size #</span>
</span><span id="FASTA.subsample-275"><a href="#FASTA.subsample-275"><span class="linenos">275</span></a>        <span class="k">if</span> <span class="n">down_to</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA.subsample-276"><a href="#FASTA.subsample-276"><span class="linenos">276</span></a>            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Can&#39;t subsample </span><span class="si">%s</span><span class="s2"> down to </span><span class="si">%i</span><span class="s2">. Only down to </span><span class="si">%i</span><span class="s2">.&quot;</span>
</span><span id="FASTA.subsample-277"><a href="#FASTA.subsample-277"><span class="linenos">277</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">Color</span><span class="o">.</span><span class="n">ylw</span> <span class="o">+</span> <span class="n">message</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">down_to</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">+</span> <span class="n">Color</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
</span><span id="FASTA.subsample-278"><a href="#FASTA.subsample-278"><span class="linenos">278</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="FASTA.subsample-279"><a href="#FASTA.subsample-279"><span class="linenos">279</span></a>            <span class="k">return</span>
</span><span id="FASTA.subsample-280"><a href="#FASTA.subsample-280"><span class="linenos">280</span></a>        <span class="c1"># Select verbosity #</span>
</span><span id="FASTA.subsample-281"><a href="#FASTA.subsample-281"><span class="linenos">281</span></a>        <span class="kn">import</span> <span class="nn">tqdm</span>
</span><span id="FASTA.subsample-282"><a href="#FASTA.subsample-282"><span class="linenos">282</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="n">wrapper</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
</span><span id="FASTA.subsample-283"><a href="#FASTA.subsample-283"><span class="linenos">283</span></a>        <span class="k">else</span><span class="p">:</span> <span class="n">wrapper</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
</span><span id="FASTA.subsample-284"><a href="#FASTA.subsample-284"><span class="linenos">284</span></a>        <span class="c1"># Generator #</span>
</span><span id="FASTA.subsample-285"><a href="#FASTA.subsample-285"><span class="linenos">285</span></a>        <span class="k">def</span> <span class="nf">iterator</span><span class="p">():</span>
</span><span id="FASTA.subsample-286"><a href="#FASTA.subsample-286"><span class="linenos">286</span></a>            <span class="k">for</span> <span class="n">read</span> <span class="ow">in</span> <span class="n">wrapper</span><span class="p">(</span><span class="n">isubsample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">down_to</span><span class="p">)):</span>
</span><span id="FASTA.subsample-287"><a href="#FASTA.subsample-287"><span class="linenos">287</span></a>                <span class="k">yield</span> <span class="n">read</span>
</span><span id="FASTA.subsample-288"><a href="#FASTA.subsample-288"><span class="linenos">288</span></a>        <span class="c1"># Do it #</span>
</span><span id="FASTA.subsample-289"><a href="#FASTA.subsample-289"><span class="linenos">289</span></a>        <span class="n">subsampled</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">iterator</span><span class="p">())</span>
</span><span id="FASTA.subsample-290"><a href="#FASTA.subsample-290"><span class="linenos">290</span></a>        <span class="c1"># Did it work #</span>
</span><span id="FASTA.subsample-291"><a href="#FASTA.subsample-291"><span class="linenos">291</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">subsampled</span><span class="p">)</span> <span class="o">==</span> <span class="n">down_to</span>
</span><span id="FASTA.subsample-292"><a href="#FASTA.subsample-292"><span class="linenos">292</span></a>        <span class="c1"># Return #</span>
</span><span id="FASTA.subsample-293"><a href="#FASTA.subsample-293"><span class="linenos">293</span></a>        <span class="k">return</span> <span class="n">subsampled</span>
</span></pre></div>


            <div class="docstring"><p>Pick a given number of sequences from the file pseudo-randomly.</p>
</div>


                            </div>
                            <div id="FASTA.rename_with_num" class="classattr">
                                        <input id="FASTA.rename_with_num-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rename_with_num</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span>, </span><span class="param"><span class="n">new_path</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">remove_desc</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FASTA.rename_with_num-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA.rename_with_num"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA.rename_with_num-295"><a href="#FASTA.rename_with_num-295"><span class="linenos">295</span></a>    <span class="k">def</span> <span class="nf">rename_with_num</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remove_desc</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="FASTA.rename_with_num-296"><a href="#FASTA.rename_with_num-296"><span class="linenos">296</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Rename every sequence based on a prefix and a number.&quot;&quot;&quot;</span>
</span><span id="FASTA.rename_with_num-297"><a href="#FASTA.rename_with_num-297"><span class="linenos">297</span></a>        <span class="c1"># Temporary path #</span>
</span><span id="FASTA.rename_with_num-298"><a href="#FASTA.rename_with_num-298"><span class="linenos">298</span></a>        <span class="k">if</span> <span class="n">new_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">numbered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_temp_path</span><span class="p">())</span>
</span><span id="FASTA.rename_with_num-299"><a href="#FASTA.rename_with_num-299"><span class="linenos">299</span></a>        <span class="k">else</span><span class="p">:</span>                <span class="n">numbered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="FASTA.rename_with_num-300"><a href="#FASTA.rename_with_num-300"><span class="linenos">300</span></a>        <span class="c1"># Generator #</span>
</span><span id="FASTA.rename_with_num-301"><a href="#FASTA.rename_with_num-301"><span class="linenos">301</span></a>        <span class="k">def</span> <span class="nf">numbered_iterator</span><span class="p">():</span>
</span><span id="FASTA.rename_with_num-302"><a href="#FASTA.rename_with_num-302"><span class="linenos">302</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">read</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA.rename_with_num-303"><a href="#FASTA.rename_with_num-303"><span class="linenos">303</span></a>                <span class="n">read</span><span class="o">.</span><span class="n">id</span>  <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="FASTA.rename_with_num-304"><a href="#FASTA.rename_with_num-304"><span class="linenos">304</span></a>                <span class="n">read</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span id="FASTA.rename_with_num-305"><a href="#FASTA.rename_with_num-305"><span class="linenos">305</span></a>                <span class="k">if</span> <span class="n">remove_desc</span><span class="p">:</span> <span class="n">read</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="FASTA.rename_with_num-306"><a href="#FASTA.rename_with_num-306"><span class="linenos">306</span></a>                <span class="k">yield</span> <span class="n">read</span>
</span><span id="FASTA.rename_with_num-307"><a href="#FASTA.rename_with_num-307"><span class="linenos">307</span></a>        <span class="c1"># Do it #</span>
</span><span id="FASTA.rename_with_num-308"><a href="#FASTA.rename_with_num-308"><span class="linenos">308</span></a>        <span class="n">numbered</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">numbered_iterator</span><span class="p">())</span>
</span><span id="FASTA.rename_with_num-309"><a href="#FASTA.rename_with_num-309"><span class="linenos">309</span></a>        <span class="c1"># Replace it #</span>
</span><span id="FASTA.rename_with_num-310"><a href="#FASTA.rename_with_num-310"><span class="linenos">310</span></a>        <span class="k">if</span> <span class="n">new_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FASTA.rename_with_num-311"><a href="#FASTA.rename_with_num-311"><span class="linenos">311</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA.rename_with_num-312"><a href="#FASTA.rename_with_num-312"><span class="linenos">312</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">numbered</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA.rename_with_num-313"><a href="#FASTA.rename_with_num-313"><span class="linenos">313</span></a>        <span class="c1"># Return #</span>
</span><span id="FASTA.rename_with_num-314"><a href="#FASTA.rename_with_num-314"><span class="linenos">314</span></a>        <span class="k">return</span> <span class="n">numbered</span>
</span></pre></div>


            <div class="docstring"><p>Rename every sequence based on a prefix and a number.</p>
</div>


                            </div>
                            <div id="FASTA.rename_with_prefix" class="classattr">
                                        <input id="FASTA.rename_with_prefix-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rename_with_prefix</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span>, </span><span class="param"><span class="n">new_path</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">in_place</span><span class="o">=</span><span class="kc">True</span>, </span><span class="param"><span class="n">remove_desc</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FASTA.rename_with_prefix-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA.rename_with_prefix"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA.rename_with_prefix-316"><a href="#FASTA.rename_with_prefix-316"><span class="linenos">316</span></a>    <span class="k">def</span> <span class="nf">rename_with_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="FASTA.rename_with_prefix-317"><a href="#FASTA.rename_with_prefix-317"><span class="linenos">317</span></a>                           <span class="n">remove_desc</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="FASTA.rename_with_prefix-318"><a href="#FASTA.rename_with_prefix-318"><span class="linenos">318</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Rename every sequence based on a prefix.&quot;&quot;&quot;</span>
</span><span id="FASTA.rename_with_prefix-319"><a href="#FASTA.rename_with_prefix-319"><span class="linenos">319</span></a>        <span class="c1"># Temporary path #</span>
</span><span id="FASTA.rename_with_prefix-320"><a href="#FASTA.rename_with_prefix-320"><span class="linenos">320</span></a>        <span class="k">if</span> <span class="n">new_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">prefixed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_temp_path</span><span class="p">())</span>
</span><span id="FASTA.rename_with_prefix-321"><a href="#FASTA.rename_with_prefix-321"><span class="linenos">321</span></a>        <span class="k">else</span><span class="p">:</span>                <span class="n">prefixed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="FASTA.rename_with_prefix-322"><a href="#FASTA.rename_with_prefix-322"><span class="linenos">322</span></a>        <span class="c1"># Generator #</span>
</span><span id="FASTA.rename_with_prefix-323"><a href="#FASTA.rename_with_prefix-323"><span class="linenos">323</span></a>        <span class="k">def</span> <span class="nf">prefixed_iterator</span><span class="p">():</span>
</span><span id="FASTA.rename_with_prefix-324"><a href="#FASTA.rename_with_prefix-324"><span class="linenos">324</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">read</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA.rename_with_prefix-325"><a href="#FASTA.rename_with_prefix-325"><span class="linenos">325</span></a>                <span class="n">read</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">read</span><span class="o">.</span><span class="n">id</span>
</span><span id="FASTA.rename_with_prefix-326"><a href="#FASTA.rename_with_prefix-326"><span class="linenos">326</span></a>                <span class="k">if</span> <span class="n">remove_desc</span><span class="p">:</span> <span class="n">read</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="FASTA.rename_with_prefix-327"><a href="#FASTA.rename_with_prefix-327"><span class="linenos">327</span></a>                <span class="k">yield</span> <span class="n">read</span>
</span><span id="FASTA.rename_with_prefix-328"><a href="#FASTA.rename_with_prefix-328"><span class="linenos">328</span></a>        <span class="c1"># Do it #</span>
</span><span id="FASTA.rename_with_prefix-329"><a href="#FASTA.rename_with_prefix-329"><span class="linenos">329</span></a>        <span class="n">prefixed</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">prefixed_iterator</span><span class="p">())</span>
</span><span id="FASTA.rename_with_prefix-330"><a href="#FASTA.rename_with_prefix-330"><span class="linenos">330</span></a>        <span class="c1"># Replace it #</span>
</span><span id="FASTA.rename_with_prefix-331"><a href="#FASTA.rename_with_prefix-331"><span class="linenos">331</span></a>        <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
</span><span id="FASTA.rename_with_prefix-332"><a href="#FASTA.rename_with_prefix-332"><span class="linenos">332</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA.rename_with_prefix-333"><a href="#FASTA.rename_with_prefix-333"><span class="linenos">333</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">prefixed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA.rename_with_prefix-334"><a href="#FASTA.rename_with_prefix-334"><span class="linenos">334</span></a>        <span class="c1"># Return #</span>
</span><span id="FASTA.rename_with_prefix-335"><a href="#FASTA.rename_with_prefix-335"><span class="linenos">335</span></a>        <span class="k">return</span> <span class="n">prefixed</span>
</span></pre></div>


            <div class="docstring"><p>Rename every sequence based on a prefix.</p>
</div>


                            </div>
                            <div id="FASTA.rename_sequences" class="classattr">
                                        <input id="FASTA.rename_sequences-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rename_sequences</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">mapping</span>, </span><span class="param"><span class="n">new_path</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">in_place</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FASTA.rename_sequences-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA.rename_sequences"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA.rename_sequences-337"><a href="#FASTA.rename_sequences-337"><span class="linenos">337</span></a>    <span class="k">def</span> <span class="nf">rename_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapping</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="FASTA.rename_sequences-338"><a href="#FASTA.rename_sequences-338"><span class="linenos">338</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FASTA.rename_sequences-339"><a href="#FASTA.rename_sequences-339"><span class="linenos">339</span></a><span class="sd">        Will rename all sequences in the current fasta file using</span>
</span><span id="FASTA.rename_sequences-340"><a href="#FASTA.rename_sequences-340"><span class="linenos">340</span></a><span class="sd">        the mapping dictionary also provided. In place or at a new path.</span>
</span><span id="FASTA.rename_sequences-341"><a href="#FASTA.rename_sequences-341"><span class="linenos">341</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FASTA.rename_sequences-342"><a href="#FASTA.rename_sequences-342"><span class="linenos">342</span></a>        <span class="c1"># Where is the new file #</span>
</span><span id="FASTA.rename_sequences-343"><a href="#FASTA.rename_sequences-343"><span class="linenos">343</span></a>        <span class="k">if</span> <span class="n">new_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">new_fasta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_temp_path</span><span class="p">())</span>
</span><span id="FASTA.rename_sequences-344"><a href="#FASTA.rename_sequences-344"><span class="linenos">344</span></a>        <span class="k">else</span><span class="p">:</span>                <span class="n">new_fasta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="FASTA.rename_sequences-345"><a href="#FASTA.rename_sequences-345"><span class="linenos">345</span></a>        <span class="c1"># Do it #</span>
</span><span id="FASTA.rename_sequences-346"><a href="#FASTA.rename_sequences-346"><span class="linenos">346</span></a>        <span class="n">new_fasta</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
</span><span id="FASTA.rename_sequences-347"><a href="#FASTA.rename_sequences-347"><span class="linenos">347</span></a>        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="FASTA.rename_sequences-348"><a href="#FASTA.rename_sequences-348"><span class="linenos">348</span></a>            <span class="n">new_name</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="n">seq</span><span class="o">.</span><span class="n">description</span><span class="p">]</span>
</span><span id="FASTA.rename_sequences-349"><a href="#FASTA.rename_sequences-349"><span class="linenos">349</span></a>            <span class="n">nucleotides</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">seq</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span>
</span><span id="FASTA.rename_sequences-350"><a href="#FASTA.rename_sequences-350"><span class="linenos">350</span></a>            <span class="n">new_fasta</span><span class="o">.</span><span class="n">add_str</span><span class="p">(</span><span class="n">nucleotides</span><span class="p">,</span> <span class="n">new_name</span><span class="p">)</span>
</span><span id="FASTA.rename_sequences-351"><a href="#FASTA.rename_sequences-351"><span class="linenos">351</span></a>        <span class="n">new_fasta</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="FASTA.rename_sequences-352"><a href="#FASTA.rename_sequences-352"><span class="linenos">352</span></a>        <span class="c1"># Return #</span>
</span><span id="FASTA.rename_sequences-353"><a href="#FASTA.rename_sequences-353"><span class="linenos">353</span></a>        <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
</span><span id="FASTA.rename_sequences-354"><a href="#FASTA.rename_sequences-354"><span class="linenos">354</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA.rename_sequences-355"><a href="#FASTA.rename_sequences-355"><span class="linenos">355</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">new_fasta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA.rename_sequences-356"><a href="#FASTA.rename_sequences-356"><span class="linenos">356</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="FASTA.rename_sequences-357"><a href="#FASTA.rename_sequences-357"><span class="linenos">357</span></a>        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">new_fasta</span>
</span></pre></div>


            <div class="docstring"><p>Will rename all sequences in the current fasta file using
the mapping dictionary also provided. In place or at a new path.</p>
</div>


                            </div>
                            <div id="FASTA.extract_length" class="classattr">
                                        <input id="FASTA.extract_length-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">extract_length</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">lower_bound</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">upper_bound</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">new_path</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FASTA.extract_length-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA.extract_length"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA.extract_length-359"><a href="#FASTA.extract_length-359"><span class="linenos">359</span></a>    <span class="k">def</span> <span class="nf">extract_length</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lower_bound</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="FASTA.extract_length-360"><a href="#FASTA.extract_length-360"><span class="linenos">360</span></a>                             <span class="n">upper_bound</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="FASTA.extract_length-361"><a href="#FASTA.extract_length-361"><span class="linenos">361</span></a>                             <span class="n">new_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="FASTA.extract_length-362"><a href="#FASTA.extract_length-362"><span class="linenos">362</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract a certain length fraction and place them in a new file.&quot;&quot;&quot;</span>
</span><span id="FASTA.extract_length-363"><a href="#FASTA.extract_length-363"><span class="linenos">363</span></a>        <span class="c1"># Temporary path #</span>
</span><span id="FASTA.extract_length-364"><a href="#FASTA.extract_length-364"><span class="linenos">364</span></a>        <span class="k">if</span> <span class="n">new_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">fraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_temp_path</span><span class="p">())</span>
</span><span id="FASTA.extract_length-365"><a href="#FASTA.extract_length-365"><span class="linenos">365</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">FASTA</span><span class="p">):</span> <span class="n">fraction</span> <span class="o">=</span> <span class="n">new_path</span>
</span><span id="FASTA.extract_length-366"><a href="#FASTA.extract_length-366"><span class="linenos">366</span></a>        <span class="k">else</span><span class="p">:</span>                <span class="n">fraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="FASTA.extract_length-367"><a href="#FASTA.extract_length-367"><span class="linenos">367</span></a>        <span class="c1"># Generator #</span>
</span><span id="FASTA.extract_length-368"><a href="#FASTA.extract_length-368"><span class="linenos">368</span></a>        <span class="k">if</span> <span class="n">lower_bound</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">lower_bound</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="FASTA.extract_length-369"><a href="#FASTA.extract_length-369"><span class="linenos">369</span></a>        <span class="k">if</span> <span class="n">upper_bound</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span>
</span><span id="FASTA.extract_length-370"><a href="#FASTA.extract_length-370"><span class="linenos">370</span></a>        <span class="k">def</span> <span class="nf">fraction_iterator</span><span class="p">():</span>
</span><span id="FASTA.extract_length-371"><a href="#FASTA.extract_length-371"><span class="linenos">371</span></a>            <span class="k">for</span> <span class="n">read</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="FASTA.extract_length-372"><a href="#FASTA.extract_length-372"><span class="linenos">372</span></a>                <span class="k">if</span> <span class="n">lower_bound</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">read</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">upper_bound</span><span class="p">:</span>
</span><span id="FASTA.extract_length-373"><a href="#FASTA.extract_length-373"><span class="linenos">373</span></a>                    <span class="k">yield</span> <span class="n">read</span>
</span><span id="FASTA.extract_length-374"><a href="#FASTA.extract_length-374"><span class="linenos">374</span></a>        <span class="c1"># Do it #</span>
</span><span id="FASTA.extract_length-375"><a href="#FASTA.extract_length-375"><span class="linenos">375</span></a>        <span class="n">fraction</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fraction_iterator</span><span class="p">())</span>
</span><span id="FASTA.extract_length-376"><a href="#FASTA.extract_length-376"><span class="linenos">376</span></a>        <span class="c1"># Return #</span>
</span><span id="FASTA.extract_length-377"><a href="#FASTA.extract_length-377"><span class="linenos">377</span></a>        <span class="k">return</span> <span class="n">fraction</span>
</span></pre></div>


            <div class="docstring"><p>Extract a certain length fraction and place them in a new file.</p>
</div>


                            </div>
                            <div id="FASTA.extract_sequences" class="classattr">
                                        <input id="FASTA.extract_sequences-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">extract_sequences</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">ids</span>, </span><span class="param"><span class="n">new_path</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">in_place</span><span class="o">=</span><span class="kc">False</span>, </span><span class="param"><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FASTA.extract_sequences-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA.extract_sequences"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA.extract_sequences-379"><a href="#FASTA.extract_sequences-379"><span class="linenos">379</span></a>    <span class="k">def</span> <span class="nf">extract_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span>
</span><span id="FASTA.extract_sequences-380"><a href="#FASTA.extract_sequences-380"><span class="linenos">380</span></a>                          <span class="n">new_path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="FASTA.extract_sequences-381"><a href="#FASTA.extract_sequences-381"><span class="linenos">381</span></a>                          <span class="n">in_place</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="FASTA.extract_sequences-382"><a href="#FASTA.extract_sequences-382"><span class="linenos">382</span></a>                          <span class="n">verbose</span>  <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="FASTA.extract_sequences-383"><a href="#FASTA.extract_sequences-383"><span class="linenos">383</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FASTA.extract_sequences-384"><a href="#FASTA.extract_sequences-384"><span class="linenos">384</span></a><span class="sd">        Will take all the sequences from the current file who&#39;s id appears in</span>
</span><span id="FASTA.extract_sequences-385"><a href="#FASTA.extract_sequences-385"><span class="linenos">385</span></a><span class="sd">        the ids given and place them in a new file.</span>
</span><span id="FASTA.extract_sequences-386"><a href="#FASTA.extract_sequences-386"><span class="linenos">386</span></a><span class="sd">        If no path is given, a new temporary path is created and returned.</span>
</span><span id="FASTA.extract_sequences-387"><a href="#FASTA.extract_sequences-387"><span class="linenos">387</span></a><span class="sd">        If `in_place` is set to True, the original file is removed and replaced</span>
</span><span id="FASTA.extract_sequences-388"><a href="#FASTA.extract_sequences-388"><span class="linenos">388</span></a><span class="sd">        with the result of the extraction.</span>
</span><span id="FASTA.extract_sequences-389"><a href="#FASTA.extract_sequences-389"><span class="linenos">389</span></a><span class="sd">        Optionally, the argument `ids` can be a function which has to take</span>
</span><span id="FASTA.extract_sequences-390"><a href="#FASTA.extract_sequences-390"><span class="linenos">390</span></a><span class="sd">        one string as only input and return True for keeping the sequence and</span>
</span><span id="FASTA.extract_sequences-391"><a href="#FASTA.extract_sequences-391"><span class="linenos">391</span></a><span class="sd">        False for discarding the sequence.</span>
</span><span id="FASTA.extract_sequences-392"><a href="#FASTA.extract_sequences-392"><span class="linenos">392</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FASTA.extract_sequences-393"><a href="#FASTA.extract_sequences-393"><span class="linenos">393</span></a>        <span class="c1"># Temporary path #</span>
</span><span id="FASTA.extract_sequences-394"><a href="#FASTA.extract_sequences-394"><span class="linenos">394</span></a>        <span class="k">if</span> <span class="n">new_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">new_fasta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_temp_path</span><span class="p">())</span>
</span><span id="FASTA.extract_sequences-395"><a href="#FASTA.extract_sequences-395"><span class="linenos">395</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">FASTA</span><span class="p">):</span> <span class="n">new_fasta</span> <span class="o">=</span> <span class="n">new_path</span>
</span><span id="FASTA.extract_sequences-396"><a href="#FASTA.extract_sequences-396"><span class="linenos">396</span></a>        <span class="k">else</span><span class="p">:</span>                <span class="n">new_fasta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="FASTA.extract_sequences-397"><a href="#FASTA.extract_sequences-397"><span class="linenos">397</span></a>        <span class="c1"># Select verbosity #</span>
</span><span id="FASTA.extract_sequences-398"><a href="#FASTA.extract_sequences-398"><span class="linenos">398</span></a>        <span class="kn">import</span> <span class="nn">tqdm</span>
</span><span id="FASTA.extract_sequences-399"><a href="#FASTA.extract_sequences-399"><span class="linenos">399</span></a>        <span class="n">wrapper</span> <span class="o">=</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span> <span class="k">if</span> <span class="n">verbose</span> <span class="k">else</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
</span><span id="FASTA.extract_sequences-400"><a href="#FASTA.extract_sequences-400"><span class="linenos">400</span></a>        <span class="c1"># Simple generator #</span>
</span><span id="FASTA.extract_sequences-401"><a href="#FASTA.extract_sequences-401"><span class="linenos">401</span></a>        <span class="k">def</span> <span class="nf">simple_match</span><span class="p">(</span><span class="n">reads</span><span class="p">):</span>
</span><span id="FASTA.extract_sequences-402"><a href="#FASTA.extract_sequences-402"><span class="linenos">402</span></a>            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">wrapper</span><span class="p">(</span><span class="n">reads</span><span class="p">):</span>
</span><span id="FASTA.extract_sequences-403"><a href="#FASTA.extract_sequences-403"><span class="linenos">403</span></a>                <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span> <span class="k">yield</span> <span class="n">r</span>
</span><span id="FASTA.extract_sequences-404"><a href="#FASTA.extract_sequences-404"><span class="linenos">404</span></a>        <span class="c1"># Generator with function #</span>
</span><span id="FASTA.extract_sequences-405"><a href="#FASTA.extract_sequences-405"><span class="linenos">405</span></a>        <span class="k">def</span> <span class="nf">function_match</span><span class="p">(</span><span class="n">reads</span><span class="p">):</span>
</span><span id="FASTA.extract_sequences-406"><a href="#FASTA.extract_sequences-406"><span class="linenos">406</span></a>            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">wrapper</span><span class="p">(</span><span class="n">reads</span><span class="p">):</span>
</span><span id="FASTA.extract_sequences-407"><a href="#FASTA.extract_sequences-407"><span class="linenos">407</span></a>                <span class="k">if</span> <span class="n">ids</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">id</span><span class="p">):</span> <span class="k">yield</span> <span class="n">r</span>
</span><span id="FASTA.extract_sequences-408"><a href="#FASTA.extract_sequences-408"><span class="linenos">408</span></a>        <span class="c1"># Do it #</span>
</span><span id="FASTA.extract_sequences-409"><a href="#FASTA.extract_sequences-409"><span class="linenos">409</span></a>        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">ids</span><span class="p">):</span>
</span><span id="FASTA.extract_sequences-410"><a href="#FASTA.extract_sequences-410"><span class="linenos">410</span></a>            <span class="n">new_fasta</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">function_match</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</span><span id="FASTA.extract_sequences-411"><a href="#FASTA.extract_sequences-411"><span class="linenos">411</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FASTA.extract_sequences-412"><a href="#FASTA.extract_sequences-412"><span class="linenos">412</span></a>            <span class="n">new_fasta</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">simple_match</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</span><span id="FASTA.extract_sequences-413"><a href="#FASTA.extract_sequences-413"><span class="linenos">413</span></a>        <span class="c1"># Return #</span>
</span><span id="FASTA.extract_sequences-414"><a href="#FASTA.extract_sequences-414"><span class="linenos">414</span></a>        <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
</span><span id="FASTA.extract_sequences-415"><a href="#FASTA.extract_sequences-415"><span class="linenos">415</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA.extract_sequences-416"><a href="#FASTA.extract_sequences-416"><span class="linenos">416</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">new_fasta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA.extract_sequences-417"><a href="#FASTA.extract_sequences-417"><span class="linenos">417</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="FASTA.extract_sequences-418"><a href="#FASTA.extract_sequences-418"><span class="linenos">418</span></a>        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">new_fasta</span>
</span></pre></div>


            <div class="docstring"><p>Will take all the sequences from the current file who's id appears in
the ids given and place them in a new file.
If no path is given, a new temporary path is created and returned.
If <code>in_place</code> is set to True, the original file is removed and replaced
with the result of the extraction.
Optionally, the argument <code><a href="#FASTA.ids">ids</a></code> can be a function which has to take
one string as only input and return True for keeping the sequence and
False for discarding the sequence.</p>
</div>


                            </div>
                            <div id="FASTA.remove_trailing_stars" class="classattr">
                                        <input id="FASTA.remove_trailing_stars-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_trailing_stars</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">new_path</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">in_place</span><span class="o">=</span><span class="kc">True</span>, </span><span class="param"><span class="n">check</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FASTA.remove_trailing_stars-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA.remove_trailing_stars"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA.remove_trailing_stars-420"><a href="#FASTA.remove_trailing_stars-420"><span class="linenos">420</span></a>    <span class="k">def</span> <span class="nf">remove_trailing_stars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="FASTA.remove_trailing_stars-421"><a href="#FASTA.remove_trailing_stars-421"><span class="linenos">421</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FASTA.remove_trailing_stars-422"><a href="#FASTA.remove_trailing_stars-422"><span class="linenos">422</span></a><span class="sd">        Remove the bad character that can be inserted by some programs at the</span>
</span><span id="FASTA.remove_trailing_stars-423"><a href="#FASTA.remove_trailing_stars-423"><span class="linenos">423</span></a><span class="sd">        end of sequences.</span>
</span><span id="FASTA.remove_trailing_stars-424"><a href="#FASTA.remove_trailing_stars-424"><span class="linenos">424</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FASTA.remove_trailing_stars-425"><a href="#FASTA.remove_trailing_stars-425"><span class="linenos">425</span></a>        <span class="c1"># Optional check #</span>
</span><span id="FASTA.remove_trailing_stars-426"><a href="#FASTA.remove_trailing_stars-426"><span class="linenos">426</span></a>        <span class="k">if</span> <span class="n">check</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">sh</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">*&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">_ok_code</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="FASTA.remove_trailing_stars-427"><a href="#FASTA.remove_trailing_stars-427"><span class="linenos">427</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="FASTA.remove_trailing_stars-428"><a href="#FASTA.remove_trailing_stars-428"><span class="linenos">428</span></a>        <span class="c1"># Faster with bash utilities #</span>
</span><span id="FASTA.remove_trailing_stars-429"><a href="#FASTA.remove_trailing_stars-429"><span class="linenos">429</span></a>        <span class="k">if</span> <span class="n">in_place</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="FASTA.remove_trailing_stars-430"><a href="#FASTA.remove_trailing_stars-430"><span class="linenos">430</span></a>            <span class="n">sh</span><span class="o">.</span><span class="n">sed</span><span class="p">(</span><span class="s1">&#39;-i&#39;</span><span class="p">,</span> <span class="s1">&#39;s/</span><span class="se">\\</span><span class="s1">*$//g&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA.remove_trailing_stars-431"><a href="#FASTA.remove_trailing_stars-431"><span class="linenos">431</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="FASTA.remove_trailing_stars-432"><a href="#FASTA.remove_trailing_stars-432"><span class="linenos">432</span></a>        <span class="c1"># Standard way #</span>
</span><span id="FASTA.remove_trailing_stars-433"><a href="#FASTA.remove_trailing_stars-433"><span class="linenos">433</span></a>        <span class="k">if</span> <span class="n">new_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">new_fasta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_temp_path</span><span class="p">())</span>
</span><span id="FASTA.remove_trailing_stars-434"><a href="#FASTA.remove_trailing_stars-434"><span class="linenos">434</span></a>        <span class="k">else</span><span class="p">:</span>                <span class="n">new_fasta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="FASTA.remove_trailing_stars-435"><a href="#FASTA.remove_trailing_stars-435"><span class="linenos">435</span></a>        <span class="n">new_fasta</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
</span><span id="FASTA.remove_trailing_stars-436"><a href="#FASTA.remove_trailing_stars-436"><span class="linenos">436</span></a>        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span> <span class="n">new_fasta</span><span class="o">.</span><span class="n">add_str</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">seq</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">),</span> <span class="n">seq</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span id="FASTA.remove_trailing_stars-437"><a href="#FASTA.remove_trailing_stars-437"><span class="linenos">437</span></a>        <span class="n">new_fasta</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="FASTA.remove_trailing_stars-438"><a href="#FASTA.remove_trailing_stars-438"><span class="linenos">438</span></a>        <span class="c1"># Return #</span>
</span><span id="FASTA.remove_trailing_stars-439"><a href="#FASTA.remove_trailing_stars-439"><span class="linenos">439</span></a>        <span class="k">return</span> <span class="n">new_fasta</span>
</span></pre></div>


            <div class="docstring"><p>Remove the bad character that can be inserted by some programs at the
end of sequences.</p>
</div>


                            </div>
                            <div id="FASTA.remove_duplicates" class="classattr">
                                        <input id="FASTA.remove_duplicates-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_duplicates</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">new_path</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">in_place</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FASTA.remove_duplicates-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA.remove_duplicates"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA.remove_duplicates-461"><a href="#FASTA.remove_duplicates-461"><span class="linenos">461</span></a>    <span class="k">def</span> <span class="nf">remove_duplicates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="FASTA.remove_duplicates-462"><a href="#FASTA.remove_duplicates-462"><span class="linenos">462</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FASTA.remove_duplicates-463"><a href="#FASTA.remove_duplicates-463"><span class="linenos">463</span></a><span class="sd">        If several entries have the same ID in the FASTA file, keep only the</span>
</span><span id="FASTA.remove_duplicates-464"><a href="#FASTA.remove_duplicates-464"><span class="linenos">464</span></a><span class="sd">        first appearance and remove all the others.</span>
</span><span id="FASTA.remove_duplicates-465"><a href="#FASTA.remove_duplicates-465"><span class="linenos">465</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FASTA.remove_duplicates-466"><a href="#FASTA.remove_duplicates-466"><span class="linenos">466</span></a>        <span class="c1"># Generator #</span>
</span><span id="FASTA.remove_duplicates-467"><a href="#FASTA.remove_duplicates-467"><span class="linenos">467</span></a>        <span class="k">def</span> <span class="nf">unique_entries</span><span class="p">():</span>
</span><span id="FASTA.remove_duplicates-468"><a href="#FASTA.remove_duplicates-468"><span class="linenos">468</span></a>            <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="FASTA.remove_duplicates-469"><a href="#FASTA.remove_duplicates-469"><span class="linenos">469</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">read</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA.remove_duplicates-470"><a href="#FASTA.remove_duplicates-470"><span class="linenos">470</span></a>                <span class="k">if</span> <span class="n">read</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span> <span class="k">continue</span>
</span><span id="FASTA.remove_duplicates-471"><a href="#FASTA.remove_duplicates-471"><span class="linenos">471</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="FASTA.remove_duplicates-472"><a href="#FASTA.remove_duplicates-472"><span class="linenos">472</span></a>                    <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">read</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span id="FASTA.remove_duplicates-473"><a href="#FASTA.remove_duplicates-473"><span class="linenos">473</span></a>                    <span class="k">yield</span> <span class="n">read</span>
</span><span id="FASTA.remove_duplicates-474"><a href="#FASTA.remove_duplicates-474"><span class="linenos">474</span></a>        <span class="c1"># Return #</span>
</span><span id="FASTA.remove_duplicates-475"><a href="#FASTA.remove_duplicates-475"><span class="linenos">475</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generator_mod</span><span class="p">(</span><span class="n">unique_entries</span><span class="p">,</span> <span class="n">new_path</span><span class="p">,</span> <span class="n">in_place</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>If several entries have the same ID in the FASTA file, keep only the
first appearance and remove all the others.</p>
</div>


                            </div>
                            <div id="FASTA.convert_U_to_T" class="classattr">
                                        <input id="FASTA.convert_U_to_T-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">convert_U_to_T</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">new_path</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">in_place</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FASTA.convert_U_to_T-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA.convert_U_to_T"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA.convert_U_to_T-477"><a href="#FASTA.convert_U_to_T-477"><span class="linenos">477</span></a>    <span class="k">def</span> <span class="nf">convert_U_to_T</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="FASTA.convert_U_to_T-478"><a href="#FASTA.convert_U_to_T-478"><span class="linenos">478</span></a>        <span class="c1"># Generator #</span>
</span><span id="FASTA.convert_U_to_T-479"><a href="#FASTA.convert_U_to_T-479"><span class="linenos">479</span></a>        <span class="k">def</span> <span class="nf">all_U_to_T</span><span class="p">():</span>
</span><span id="FASTA.convert_U_to_T-480"><a href="#FASTA.convert_U_to_T-480"><span class="linenos">480</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">read</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA.convert_U_to_T-481"><a href="#FASTA.convert_U_to_T-481"><span class="linenos">481</span></a>                <span class="n">read</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">back_transcribe</span><span class="p">()</span>
</span><span id="FASTA.convert_U_to_T-482"><a href="#FASTA.convert_U_to_T-482"><span class="linenos">482</span></a>                <span class="k">yield</span> <span class="n">read</span>
</span><span id="FASTA.convert_U_to_T-483"><a href="#FASTA.convert_U_to_T-483"><span class="linenos">483</span></a>        <span class="c1"># Return #</span>
</span><span id="FASTA.convert_U_to_T-484"><a href="#FASTA.convert_U_to_T-484"><span class="linenos">484</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generator_mod</span><span class="p">(</span><span class="n">all_U_to_T</span><span class="p">,</span> <span class="n">new_path</span><span class="p">,</span> <span class="n">in_place</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="FASTA.align" class="classattr">
                                        <input id="FASTA.align-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">align</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">out_path</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FASTA.align-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA.align"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA.align-487"><a href="#FASTA.align-487"><span class="linenos">487</span></a>    <span class="k">def</span> <span class="nf">align</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="FASTA.align-488"><a href="#FASTA.align-488"><span class="linenos">488</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;We align the sequences in the fasta file with muscle.&quot;&quot;&quot;</span>
</span><span id="FASTA.align-489"><a href="#FASTA.align-489"><span class="linenos">489</span></a>        <span class="k">if</span> <span class="n">out_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">out_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix_path</span> <span class="o">+</span> <span class="s1">&#39;.aln&#39;</span>
</span><span id="FASTA.align-490"><a href="#FASTA.align-490"><span class="linenos">490</span></a>        <span class="n">sh</span><span class="o">.</span><span class="n">muscle38</span><span class="p">(</span><span class="s2">&quot;-in&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;-out&quot;</span><span class="p">,</span> <span class="n">out_path</span><span class="p">)</span>
</span><span id="FASTA.align-491"><a href="#FASTA.align-491"><span class="linenos">491</span></a>        <span class="kn">from</span> <span class="nn">fasta.aligned</span> <span class="kn">import</span> <span class="n">AlignedFASTA</span>
</span><span id="FASTA.align-492"><a href="#FASTA.align-492"><span class="linenos">492</span></a>        <span class="k">return</span> <span class="n">AlignedFASTA</span><span class="p">(</span><span class="n">out_path</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>We align the sequences in the fasta file with muscle.</p>
</div>


                            </div>
                            <div id="FASTA.template_align" class="classattr">
                                        <input id="FASTA.template_align-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">template_align</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">ref_path</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FASTA.template_align-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA.template_align"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA.template_align-494"><a href="#FASTA.template_align-494"><span class="linenos">494</span></a>    <span class="k">def</span> <span class="nf">template_align</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_path</span><span class="p">):</span>
</span><span id="FASTA.template_align-495"><a href="#FASTA.template_align-495"><span class="linenos">495</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FASTA.template_align-496"><a href="#FASTA.template_align-496"><span class="linenos">496</span></a><span class="sd">        We align the sequences in the fasta file with mothur and a template.</span>
</span><span id="FASTA.template_align-497"><a href="#FASTA.template_align-497"><span class="linenos">497</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FASTA.template_align-498"><a href="#FASTA.template_align-498"><span class="linenos">498</span></a>        <span class="c1"># Run it #</span>
</span><span id="FASTA.template_align-499"><a href="#FASTA.template_align-499"><span class="linenos">499</span></a>        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;#align.seqs(candidate=</span><span class="si">%s</span><span class="s2">, template=</span><span class="si">%s</span><span class="s2">, search=blast,&quot;</span> \
</span><span id="FASTA.template_align-500"><a href="#FASTA.template_align-500"><span class="linenos">500</span></a>              <span class="s2">&quot;flip=false, processors=8);&quot;</span>
</span><span id="FASTA.template_align-501"><a href="#FASTA.template_align-501"><span class="linenos">501</span></a>        <span class="n">sh</span><span class="o">.</span><span class="n">mothur</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">ref_path</span><span class="p">))</span>
</span><span id="FASTA.template_align-502"><a href="#FASTA.template_align-502"><span class="linenos">502</span></a>        <span class="c1"># Move things #</span>
</span><span id="FASTA.template_align-503"><a href="#FASTA.template_align-503"><span class="linenos">503</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.align&#39;</span><span class="p">,</span>        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">aligned</span><span class="p">)</span>
</span><span id="FASTA.template_align-504"><a href="#FASTA.template_align-504"><span class="linenos">504</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.align.report&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">report</span><span class="p">)</span>
</span><span id="FASTA.template_align-505"><a href="#FASTA.template_align-505"><span class="linenos">505</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.flip.accnos&#39;</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">accnos</span><span class="p">)</span>
</span><span id="FASTA.template_align-506"><a href="#FASTA.template_align-506"><span class="linenos">506</span></a>        <span class="c1"># Clean up #</span>
</span><span id="FASTA.template_align-507"><a href="#FASTA.template_align-507"><span class="linenos">507</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;formatdb.log&#39;</span><span class="p">):</span>
</span><span id="FASTA.template_align-508"><a href="#FASTA.template_align-508"><span class="linenos">508</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;formatdb.log&#39;</span><span class="p">)</span>
</span><span id="FASTA.template_align-509"><a href="#FASTA.template_align-509"><span class="linenos">509</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;error.log&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="s1">&#39;error.log&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="FASTA.template_align-510"><a href="#FASTA.template_align-510"><span class="linenos">510</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;error.log&#39;</span><span class="p">)</span>
</span><span id="FASTA.template_align-511"><a href="#FASTA.template_align-511"><span class="linenos">511</span></a>        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">sh</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;mothur.*.logfile&#39;</span><span class="p">):</span>
</span><span id="FASTA.template_align-512"><a href="#FASTA.template_align-512"><span class="linenos">512</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA.template_align-513"><a href="#FASTA.template_align-513"><span class="linenos">513</span></a>        <span class="c1"># Return #</span>
</span><span id="FASTA.template_align-514"><a href="#FASTA.template_align-514"><span class="linenos">514</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">aligned</span>
</span></pre></div>


            <div class="docstring"><p>We align the sequences in the fasta file with mothur and a template.</p>
</div>


                            </div>
                            <div id="FASTA.index_bowtie" class="classattr">
                                        <input id="FASTA.index_bowtie-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">index_bowtie</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FASTA.index_bowtie-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA.index_bowtie"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA.index_bowtie-516"><a href="#FASTA.index_bowtie-516"><span class="linenos">516</span></a>    <span class="k">def</span> <span class="nf">index_bowtie</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA.index_bowtie-517"><a href="#FASTA.index_bowtie-517"><span class="linenos">517</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an index on the fasta file compatible with bowtie2.&quot;&quot;&quot;</span>
</span><span id="FASTA.index_bowtie-518"><a href="#FASTA.index_bowtie-518"><span class="linenos">518</span></a>        <span class="c1"># It returns exit code 1 if the fasta is empty #</span>
</span><span id="FASTA.index_bowtie-519"><a href="#FASTA.index_bowtie-519"><span class="linenos">519</span></a>        <span class="k">assert</span> <span class="bp">self</span>
</span><span id="FASTA.index_bowtie-520"><a href="#FASTA.index_bowtie-520"><span class="linenos">520</span></a>        <span class="c1"># Call the bowtie executable #</span>
</span><span id="FASTA.index_bowtie-521"><a href="#FASTA.index_bowtie-521"><span class="linenos">521</span></a>        <span class="n">sh</span><span class="o">.</span><span class="n">bowtie2_build</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA.index_bowtie-522"><a href="#FASTA.index_bowtie-522"><span class="linenos">522</span></a>        <span class="k">return</span> <span class="n">FilePath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;.1.bt2&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create an index on the fasta file compatible with bowtie2.</p>
</div>


                            </div>
                            <div id="FASTA.index_samtools" class="classattr">
                                        <input id="FASTA.index_samtools-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">index_samtools</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FASTA.index_samtools-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA.index_samtools"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA.index_samtools-524"><a href="#FASTA.index_samtools-524"><span class="linenos">524</span></a>    <span class="k">def</span> <span class="nf">index_samtools</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FASTA.index_samtools-525"><a href="#FASTA.index_samtools-525"><span class="linenos">525</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an index on the fasta file compatible with samtools.&quot;&quot;&quot;</span>
</span><span id="FASTA.index_samtools-526"><a href="#FASTA.index_samtools-526"><span class="linenos">526</span></a>        <span class="n">sh</span><span class="o">.</span><span class="n">samtools</span><span class="p">(</span><span class="s1">&#39;faidx&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FASTA.index_samtools-527"><a href="#FASTA.index_samtools-527"><span class="linenos">527</span></a>        <span class="k">return</span> <span class="n">FilePath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;.fai&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create an index on the fasta file compatible with samtools.</p>
</div>


                            </div>
                            <div id="FASTA.graphs" class="classattr">
                                <div class="attr variable">
            <span class="name">graphs</span>

        
    </div>
    <a class="headerlink" href="#FASTA.graphs"></a>
    
            <div class="docstring"><p>Sorry for the black magic. The result is an object whose attributes
are all the graphs found in <code>./graphs.py</code> initialized with this
instance as only argument.</p>
</div>


                            </div>
                            <div id="FASTA.parse_primers" class="classattr">
                                        <input id="FASTA.parse_primers-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parse_primers</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">primers</span>, </span><span class="param"><span class="n">mismatches</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FASTA.parse_primers-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FASTA.parse_primers"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FASTA.parse_primers-547"><a href="#FASTA.parse_primers-547"><span class="linenos">547</span></a>    <span class="k">def</span> <span class="nf">parse_primers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">primers</span><span class="p">,</span> <span class="n">mismatches</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="FASTA.parse_primers-548"><a href="#FASTA.parse_primers-548"><span class="linenos">548</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FASTA.parse_primers-549"><a href="#FASTA.parse_primers-549"><span class="linenos">549</span></a><span class="sd">        Takes care of identifying primers inside every sequence.</span>
</span><span id="FASTA.parse_primers-550"><a href="#FASTA.parse_primers-550"><span class="linenos">550</span></a><span class="sd">        Instead of yielding Seq objects now we yield ReadWithPrimers objects.</span>
</span><span id="FASTA.parse_primers-551"><a href="#FASTA.parse_primers-551"><span class="linenos">551</span></a><span class="sd">        These have extra properties that show the start and end positions</span>
</span><span id="FASTA.parse_primers-552"><a href="#FASTA.parse_primers-552"><span class="linenos">552</span></a><span class="sd">        of all primers found.</span>
</span><span id="FASTA.parse_primers-553"><a href="#FASTA.parse_primers-553"><span class="linenos">553</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FASTA.parse_primers-554"><a href="#FASTA.parse_primers-554"><span class="linenos">554</span></a>        <span class="c1"># Default is zero #</span>
</span><span id="FASTA.parse_primers-555"><a href="#FASTA.parse_primers-555"><span class="linenos">555</span></a>        <span class="k">if</span> <span class="n">mismatches</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">mismatches</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="FASTA.parse_primers-556"><a href="#FASTA.parse_primers-556"><span class="linenos">556</span></a>        <span class="c1"># Get the search expressions with mismatches #</span>
</span><span id="FASTA.parse_primers-557"><a href="#FASTA.parse_primers-557"><span class="linenos">557</span></a>        <span class="kn">from</span> <span class="nn">fasta.primers</span> <span class="kn">import</span> <span class="n">PrimersRegexes</span>
</span><span id="FASTA.parse_primers-558"><a href="#FASTA.parse_primers-558"><span class="linenos">558</span></a>        <span class="n">regexes</span> <span class="o">=</span> <span class="n">PrimersRegexes</span><span class="p">(</span><span class="n">primers</span><span class="p">,</span> <span class="n">mismatches</span><span class="p">)</span>
</span><span id="FASTA.parse_primers-559"><a href="#FASTA.parse_primers-559"><span class="linenos">559</span></a>        <span class="c1"># Generate a new special object for every read #</span>
</span><span id="FASTA.parse_primers-560"><a href="#FASTA.parse_primers-560"><span class="linenos">560</span></a>        <span class="kn">from</span> <span class="nn">fasta.primers</span> <span class="kn">import</span> <span class="n">ReadWithPrimers</span>
</span><span id="FASTA.parse_primers-561"><a href="#FASTA.parse_primers-561"><span class="linenos">561</span></a>        <span class="n">read_with_primer</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">read</span><span class="p">:</span> <span class="n">ReadWithPrimers</span><span class="p">(</span><span class="n">read</span><span class="p">,</span> <span class="n">regexes</span><span class="p">)</span>
</span><span id="FASTA.parse_primers-562"><a href="#FASTA.parse_primers-562"><span class="linenos">562</span></a>        <span class="n">generator</span> <span class="o">=</span> <span class="p">(</span><span class="n">read_with_primer</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">())</span>
</span><span id="FASTA.parse_primers-563"><a href="#FASTA.parse_primers-563"><span class="linenos">563</span></a>        <span class="c1"># Add the length to the generator #</span>
</span><span id="FASTA.parse_primers-564"><a href="#FASTA.parse_primers-564"><span class="linenos">564</span></a>        <span class="kn">from</span> <span class="nn">plumbing.common</span> <span class="kn">import</span> <span class="n">GenWithLength</span>
</span><span id="FASTA.parse_primers-565"><a href="#FASTA.parse_primers-565"><span class="linenos">565</span></a>        <span class="n">generator</span> <span class="o">=</span> <span class="n">GenWithLength</span><span class="p">(</span><span class="n">generator</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</span><span id="FASTA.parse_primers-566"><a href="#FASTA.parse_primers-566"><span class="linenos">566</span></a>        <span class="c1"># Return #</span>
</span><span id="FASTA.parse_primers-567"><a href="#FASTA.parse_primers-567"><span class="linenos">567</span></a>        <span class="k">return</span> <span class="n">generator</span>
</span></pre></div>


            <div class="docstring"><p>Takes care of identifying primers inside every sequence.
Instead of yielding Seq objects now we yield ReadWithPrimers objects.
These have extra properties that show the start and end positions
of all primers found.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>autopaths.base_path.BasePath</dt>
                                <dd id="FASTA.__init__" class="function">BasePath</dd>
                <dd id="FASTA.clean_path" class="function">clean_path</dd>
                <dd id="FASTA.path" class="variable">path</dd>
                <dd id="FASTA.short_prefix" class="variable">short_prefix</dd>
                <dd id="FASTA.extension" class="variable">extension</dd>
                <dd id="FASTA.escaped" class="variable">escaped</dd>
                <dd id="FASTA.absolute_path" class="variable">absolute_path</dd>
                <dd id="FASTA.physical_path" class="variable">physical_path</dd>
                <dd id="FASTA.relative_path" class="variable">relative_path</dd>
                <dd id="FASTA.rel_path_from" class="function">rel_path_from</dd>
                <dd id="FASTA.exists" class="variable">exists</dd>
                <dd id="FASTA.is_symlink" class="variable">is_symlink</dd>
                <dd id="FASTA.permissions" class="variable">permissions</dd>
                <dd id="FASTA.mdate" class="variable">mdate</dd>
                <dd id="FASTA.mdate_iso" class="variable">mdate_iso</dd>
                <dd id="FASTA.cdate" class="variable">cdate</dd>
                <dd id="FASTA.cdate_iso" class="variable">cdate_iso</dd>
                <dd id="FASTA.unix_style" class="variable">unix_style</dd>
                <dd id="FASTA.wsl_style" class="variable">wsl_style</dd>
                <dd id="FASTA.win_style" class="variable">win_style</dd>
                <dd id="FASTA.with_tilda" class="variable">with_tilda</dd>
                <dd id="FASTA.with_home" class="variable">with_home</dd>
                <dd id="FASTA.link_from" class="function">link_from</dd>
                <dd id="FASTA.link_to" class="function">link_to</dd>
                <dd id="FASTA.symlinks_on_linux" class="function">symlinks_on_linux</dd>
                <dd id="FASTA.symlinks_on_windows" class="function">symlinks_on_windows</dd>
                <dd id="FASTA.hard_link_win_to" class="function">hard_link_win_to</dd>

            </div>
            <div><dt>autopaths.file_path.FilePath</dt>
                                <dd id="FASTA.prefix_path" class="variable">prefix_path</dd>
                <dd id="FASTA.prefix" class="variable">prefix</dd>
                <dd id="FASTA.name" class="variable">name</dd>
                <dd id="FASTA.filename" class="variable">filename</dd>
                <dd id="FASTA.directory" class="variable">directory</dd>
                <dd id="FASTA.count_bytes" class="variable">count_bytes</dd>
                <dd id="FASTA.size" class="variable">size</dd>
                <dd id="FASTA.contents" class="variable">contents</dd>
                <dd id="FASTA.contents_utf8" class="variable">contents_utf8</dd>
                <dd id="FASTA.md5" class="variable">md5</dd>
                <dd id="FASTA.might_be_binary" class="variable">might_be_binary</dd>
                <dd id="FASTA.contains_binary" class="variable">contains_binary</dd>
                <dd id="FASTA.magic_number" class="variable">magic_number</dd>
                <dd id="FASTA.lines" class="variable">lines</dd>
                <dd id="FASTA.read" class="function">read</dd>
                <dd id="FASTA.touch" class="function">touch</dd>
                <dd id="FASTA.writelines" class="function">writelines</dd>
                <dd id="FASTA.remove" class="function">remove</dd>
                <dd id="FASTA.copy" class="function">copy</dd>
                <dd id="FASTA.execute" class="function">execute</dd>
                <dd id="FASTA.replace_extension" class="function">replace_extension</dd>
                <dd id="FASTA.new_name_insert" class="function">new_name_insert</dd>
                <dd id="FASTA.make_directory" class="function">make_directory</dd>
                <dd id="FASTA.must_exist" class="function">must_exist</dd>
                <dd id="FASTA.head" class="function">head</dd>
                <dd id="FASTA.pretty_head" class="variable">pretty_head</dd>
                <dd id="FASTA.tail" class="function">tail</dd>
                <dd id="FASTA.pretty_tail" class="variable">pretty_tail</dd>
                <dd id="FASTA.move_to" class="function">move_to</dd>
                <dd id="FASTA.rename" class="function">rename</dd>
                <dd id="FASTA.gzip_to" class="function">gzip_to</dd>
                <dd id="FASTA.gzip_internal" class="function">gzip_internal</dd>
                <dd id="FASTA.gzip_external" class="function">gzip_external</dd>
                <dd id="FASTA.gzip_pigz" class="function">gzip_pigz</dd>
                <dd id="FASTA.ungzip_to" class="function">ungzip_to</dd>
                <dd id="FASTA.ungzip_internal" class="function">ungzip_internal</dd>
                <dd id="FASTA.ungzip_external" class="function">ungzip_external</dd>
                <dd id="FASTA.zip_to" class="function">zip_to</dd>
                <dd id="FASTA.unzip_to" class="function">unzip_to</dd>
                <dd id="FASTA.untar_to" class="function">untar_to</dd>
                <dd id="FASTA.untargz_to" class="function">untargz_to</dd>
                <dd id="FASTA.untargz_to_internal" class="function">untargz_to_internal</dd>
                <dd id="FASTA.untargz_to_external" class="function">untargz_to_external</dd>
                <dd id="FASTA.append" class="function">append</dd>
                <dd id="FASTA.prepend" class="function">prepend</dd>
                <dd id="FASTA.remove_line" class="function">remove_line</dd>
                <dd id="FASTA.remove_first_line" class="function">remove_first_line</dd>
                <dd id="FASTA.replace_line" class="function">replace_line</dd>
                <dd id="FASTA.replace_word" class="function">replace_word</dd>
                <dd id="FASTA.sed_replace" class="function">sed_replace</dd>

            </div>
            <div><dt>builtins.str</dt>
                                <dd id="FASTA.encode" class="function">encode</dd>
                <dd id="FASTA.replace" class="function">replace</dd>
                <dd id="FASTA.split" class="function">split</dd>
                <dd id="FASTA.rsplit" class="function">rsplit</dd>
                <dd id="FASTA.join" class="function">join</dd>
                <dd id="FASTA.capitalize" class="function">capitalize</dd>
                <dd id="FASTA.casefold" class="function">casefold</dd>
                <dd id="FASTA.title" class="function">title</dd>
                <dd id="FASTA.center" class="function">center</dd>
                <dd id="FASTA.expandtabs" class="function">expandtabs</dd>
                <dd id="FASTA.find" class="function">find</dd>
                <dd id="FASTA.partition" class="function">partition</dd>
                <dd id="FASTA.index" class="function">index</dd>
                <dd id="FASTA.ljust" class="function">ljust</dd>
                <dd id="FASTA.lower" class="function">lower</dd>
                <dd id="FASTA.lstrip" class="function">lstrip</dd>
                <dd id="FASTA.rfind" class="function">rfind</dd>
                <dd id="FASTA.rindex" class="function">rindex</dd>
                <dd id="FASTA.rjust" class="function">rjust</dd>
                <dd id="FASTA.rstrip" class="function">rstrip</dd>
                <dd id="FASTA.rpartition" class="function">rpartition</dd>
                <dd id="FASTA.splitlines" class="function">splitlines</dd>
                <dd id="FASTA.strip" class="function">strip</dd>
                <dd id="FASTA.swapcase" class="function">swapcase</dd>
                <dd id="FASTA.translate" class="function">translate</dd>
                <dd id="FASTA.upper" class="function">upper</dd>
                <dd id="FASTA.startswith" class="function">startswith</dd>
                <dd id="FASTA.endswith" class="function">endswith</dd>
                <dd id="FASTA.removeprefix" class="function">removeprefix</dd>
                <dd id="FASTA.removesuffix" class="function">removesuffix</dd>
                <dd id="FASTA.isascii" class="function">isascii</dd>
                <dd id="FASTA.islower" class="function">islower</dd>
                <dd id="FASTA.isupper" class="function">isupper</dd>
                <dd id="FASTA.istitle" class="function">istitle</dd>
                <dd id="FASTA.isspace" class="function">isspace</dd>
                <dd id="FASTA.isdecimal" class="function">isdecimal</dd>
                <dd id="FASTA.isdigit" class="function">isdigit</dd>
                <dd id="FASTA.isnumeric" class="function">isnumeric</dd>
                <dd id="FASTA.isalpha" class="function">isalpha</dd>
                <dd id="FASTA.isalnum" class="function">isalnum</dd>
                <dd id="FASTA.isidentifier" class="function">isidentifier</dd>
                <dd id="FASTA.isprintable" class="function">isprintable</dd>
                <dd id="FASTA.zfill" class="function">zfill</dd>
                <dd id="FASTA.format_map" class="function">format_map</dd>
                <dd id="FASTA.maketrans" class="function">maketrans</dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>